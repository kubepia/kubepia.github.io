<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OCP-ignition파일 및 VM생성 | Kubepia Documents</title>
    <meta name="description" content="Technical guidelines about kubernetes">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png">
  <link rel="manifest" href="/assets/favicons/site.webmanifest">
    
    <link rel="preload" href="/assets/css/0.styles.6963f482.css" as="style"><link rel="preload" href="/assets/js/app.bf8a7b73.js" as="script"><link rel="preload" href="/assets/js/2.dcea4fc4.js" as="script"><link rel="preload" href="/assets/js/3.c3678dfd.js" as="script"><link rel="prefetch" href="/assets/js/10.0dc96b33.js"><link rel="prefetch" href="/assets/js/11.25431a0b.js"><link rel="prefetch" href="/assets/js/12.a8b205c5.js"><link rel="prefetch" href="/assets/js/13.b6e5137f.js"><link rel="prefetch" href="/assets/js/14.a4aadaa2.js"><link rel="prefetch" href="/assets/js/15.2c7d00f3.js"><link rel="prefetch" href="/assets/js/16.0ab776b4.js"><link rel="prefetch" href="/assets/js/17.58800b2a.js"><link rel="prefetch" href="/assets/js/18.b98c1aba.js"><link rel="prefetch" href="/assets/js/19.a4e52a40.js"><link rel="prefetch" href="/assets/js/20.973259df.js"><link rel="prefetch" href="/assets/js/21.21b48f79.js"><link rel="prefetch" href="/assets/js/22.7d878c3e.js"><link rel="prefetch" href="/assets/js/23.678358a3.js"><link rel="prefetch" href="/assets/js/24.694d3381.js"><link rel="prefetch" href="/assets/js/25.4e0a8e8d.js"><link rel="prefetch" href="/assets/js/26.c31b451b.js"><link rel="prefetch" href="/assets/js/27.62742e6a.js"><link rel="prefetch" href="/assets/js/28.fc0ff6a4.js"><link rel="prefetch" href="/assets/js/29.e4e36302.js"><link rel="prefetch" href="/assets/js/30.cc9ddac8.js"><link rel="prefetch" href="/assets/js/31.d19e0451.js"><link rel="prefetch" href="/assets/js/32.a9b66499.js"><link rel="prefetch" href="/assets/js/33.32d201bd.js"><link rel="prefetch" href="/assets/js/34.041ca506.js"><link rel="prefetch" href="/assets/js/35.3b521c66.js"><link rel="prefetch" href="/assets/js/36.7e0f4872.js"><link rel="prefetch" href="/assets/js/37.19c8d95d.js"><link rel="prefetch" href="/assets/js/38.724ed647.js"><link rel="prefetch" href="/assets/js/39.e878add5.js"><link rel="prefetch" href="/assets/js/4.32b97f8d.js"><link rel="prefetch" href="/assets/js/40.898af31a.js"><link rel="prefetch" href="/assets/js/41.828da5d1.js"><link rel="prefetch" href="/assets/js/42.6ea7a625.js"><link rel="prefetch" href="/assets/js/5.612db0cd.js"><link rel="prefetch" href="/assets/js/6.7c4be80a.js"><link rel="prefetch" href="/assets/js/7.66c82c48.js"><link rel="prefetch" href="/assets/js/8.010f9f78.js"><link rel="prefetch" href="/assets/js/9.d709d58d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6963f482.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/kubepia.png" alt="Kubepia Documents" class="logo"> <span class="site-name can-hide">Kubepia Documents</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/devops/overview.html" class="nav-link">
  DevOps
</a></div><div class="nav-item"><a href="/k8s/" class="nav-link">
  K8S
</a></div><div class="nav-item"><a href="/ocp/overview.html" class="nav-link">
  OCP4.X
</a></div><div class="nav-item"><a href="/cloudpak/overview.html" class="nav-link">
  CloudPak
</a></div><div class="nav-item"><a href="/architecture/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="/aboutus/iamnogada.html" class="nav-link">
  About US
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/devops/overview.html" class="nav-link">
  DevOps
</a></div><div class="nav-item"><a href="/k8s/" class="nav-link">
  K8S
</a></div><div class="nav-item"><a href="/ocp/overview.html" class="nav-link">
  OCP4.X
</a></div><div class="nav-item"><a href="/cloudpak/overview.html" class="nav-link">
  CloudPak
</a></div><div class="nav-item"><a href="/architecture/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="/aboutus/iamnogada.html" class="nav-link">
  About US
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>CloudPak</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/cloudpak/cp4app/overview" class="sidebar-heading clickable open"><span>CP4App</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading open"><span>Install</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cloudpak/cp4app/install/infra01.html" class="sidebar-link">Infra Servers-VM 생성</a></li><li><a href="/cloudpak/cp4app/install/infra02.html" class="sidebar-link">Infra Servers-Web서버 설치</a></li><li><a href="/cloudpak/cp4app/install/infra03.html" class="sidebar-link">Infra Servers-VM Network 설정</a></li><li><a href="/cloudpak/cp4app/install/infra04.html" class="sidebar-link">Infra Servers-DNS서버 설치</a></li><li><a href="/cloudpak/cp4app/install/infra05.html" class="sidebar-link">Infra Servers-HAProxy서버 설치</a></li><li><a href="/cloudpak/cp4app/install/infra06.html" class="sidebar-link">Infra Servers-DHCP서버 설치</a></li><li><a href="/cloudpak/cp4app/install/infra07.html" class="sidebar-link">Infra Servers-NFS서버 설치</a></li><li><a href="/cloudpak/cp4app/install/infra08.html" class="sidebar-link">Infra Servers-SSLKey 구성</a></li><li><a href="/cloudpak/cp4app/install/infra09.html" class="sidebar-link">Infra Servers-iptables 설치</a></li><li><a href="/cloudpak/cp4app/install/ocp01.html" class="active sidebar-link">OCP-ignition파일 및 VM생성</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#사전준비" class="sidebar-link">사전준비</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#설치-프로그램-다운로드" class="sidebar-link">설치 프로그램 다운로드</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#설치-작업-디렉토리-생성" class="sidebar-link">설치 작업 디렉토리 생성</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#install-config-yaml-생성" class="sidebar-link">install-config.yaml 생성</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#install-manifest파일-생성-및-수정" class="sidebar-link">install manifest파일 생성 및 수정</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#ignition-파일-생성" class="sidebar-link">ignition 파일 생성</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#append-bootstrap-ign파일-생성" class="sidebar-link">append-bootstrap.ign파일 생성</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#ignition파일-base64-encoding" class="sidebar-link">ignition파일 base64 encoding</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#vm-template-작성" class="sidebar-link">VM Template 작성</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#bootstrap-node-vm-생성" class="sidebar-link">Bootstrap Node VM 생성</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#master-node-vm-생성" class="sidebar-link">Master Node VM 생성</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#worker-node-vm-생성" class="sidebar-link">Worker Node VM 생성</a></li></ul></li><li><a href="/cloudpak/cp4app/install/ocp02.html" class="sidebar-link">OCP-OCP설치</a></li><li><a href="/cloudpak/cp4app/install/ocp03.html" class="sidebar-link">OCP-NFS Dynamic provisioning</a></li><li><a href="/cloudpak/cp4app/install/ocp04.html" class="sidebar-link">OCP-Local Image Registry 구성</a></li><li><a href="/cloudpak/cp4app/install/cp4app01.html" class="sidebar-link">CP4App-LDAP 설치</a></li><li><a href="/cloudpak/cp4app/install/cp4app02.html" class="sidebar-link">CP4App-Common Service 설치</a></li><li><a href="/cloudpak/cp4app/install/cp4app03.html" class="sidebar-link">CP4App-OCP IdP로 등록</a></li><li><a href="/cloudpak/cp4app/install/cp4app04.html" class="sidebar-link">CP4App-CP4App 설치</a></li></ul></section></li></ul></section></li><li><a href="/cloudpak/cp4mm/overview.html" class="sidebar-link">CP4MM</a></li><li><a href="/cloudpak/md-sample.html" class="sidebar-link">Markdown sample</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ocp-ignition파일-및-vm생성"><a href="#ocp-ignition파일-및-vm생성" class="header-anchor">#</a> OCP-ignition파일 및 VM생성</h1> <div class="custom-block tip"><p class="custom-block-title">TASK DESCRIPTION</p> <p>ignition파일은 RHCOS(RedHat Core OS)가 실행될때 참조하는 제반설정정보입니다.<br>
openshift-install명령을 이용하여 ignition 파일을 생성합니다.<br>
생성된 파일의 내용을 base64로 암호화하여 VM Node의 속성으로 등록합니다.<br>
버전별 설치가이드를 참고하십시오.</p> <ul><li><a href="https://docs.openshift.com/container-platform/4.3/installing/installing_vsphere/installing-vsphere.html" target="_blank" rel="noopener noreferrer">OCP4.3 install 가이드<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.openshift.com/container-platform/4.4/installing/installing_vsphere/installing-vsphere.html" target="_blank" rel="noopener noreferrer">OCP4.4 install 가이드<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
본 설치매뉴얼은 vmware vSphere상의 설치를 위해 작성되었습니다.</li></ul> <p></p><div class="table-of-contents"><ul><li><a href="#사전준비">사전준비</a></li><li><a href="#설치-프로그램-다운로드">설치 프로그램 다운로드</a></li><li><a href="#설치-작업-디렉토리-생성">설치 작업 디렉토리 생성</a></li><li><a href="#install-config-yaml-생성">install-config.yaml 생성</a></li><li><a href="#install-manifest파일-생성-및-수정">install manifest파일 생성 및 수정</a></li><li><a href="#ignition-파일-생성">ignition 파일 생성</a></li><li><a href="#append-bootstrap-ign파일-생성">append-bootstrap.ign파일 생성</a></li><li><a href="#ignition파일-base64-encoding">ignition파일 base64 encoding</a></li><li><a href="#vm-template-작성">VM Template 작성</a></li><li><a href="#bootstrap-node-vm-생성">Bootstrap Node VM 생성</a></li><li><a href="#master-node-vm-생성">Master Node VM 생성</a></li><li><a href="#worker-node-vm-생성">Worker Node VM 생성</a></li></ul></div><p></p></div> <h2 id="사전준비"><a href="#사전준비" class="header-anchor">#</a> 사전준비</h2> <ul><li><p><strong>vSphere버전</strong><br>
vSphere 6.5상에도 설치가능하지만 vSphere Version 6.7 U2이상을 권장합니다.</p></li> <li><p><strong>System requirements</strong>
문서상의 최소 사양은 아래와 같습니다.<br> <img src="/assets/img/2020-05-25-02-38-00.defb37ee.png" alt=""></p></li></ul> <p>경험상 CP4App까지 설치하여 운영하기 위한 사양은 아래와 같습니다.</p> <table><thead><tr><th style="text-align:left;">Machine</th> <th style="text-align:left;">vCPU</th> <th style="text-align:left;">vRAM</th> <th style="text-align:left;">Storage</th></tr></thead> <tbody><tr><td style="text-align:left;">Bootstrap</td> <td style="text-align:left;">8</td> <td style="text-align:left;">16</td> <td style="text-align:left;">120</td></tr> <tr><td style="text-align:left;">Control plane</td> <td style="text-align:left;">8</td> <td style="text-align:left;">32</td> <td style="text-align:left;">120</td></tr> <tr><td style="text-align:left;">Compute</td> <td style="text-align:left;">16</td> <td style="text-align:left;">32</td> <td style="text-align:left;">120</td></tr></tbody></table> <p>Master Node는 최소 3개이상, Worker Node는 최소 2개 이상 필요합니다.</p> <ul><li><strong>User Provisioned Infra 환경 준비</strong><br>
아래와 같은 인프라 환경구성이 필요합니다.
<ul><li>Network connections</li> <li>DNS</li> <li>L/B</li> <li>DHCP</li> <li>Configure Ports
참조: <a href="https://docs.openshift.com/container-platform/4.3/installing/installing_vsphere/installing-vsphere.html#installation-network-user-infra_installing-vsphere" target="_blank" rel="noopener noreferrer">User provisioned infrastructure<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <h2 id="설치-프로그램-다운로드"><a href="#설치-프로그램-다운로드" class="header-anchor">#</a> 설치 프로그램 다운로드</h2> <ul><li><p>**<a href="https://cloud.redhat.com/openshift/install" target="_blank" rel="noopener noreferrer">Redhat 설치 가이드<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>**으로 로그인합니다.<br>
그리고 설치 인프라 환경을 선택하십시오.  본 매뉴얼에서는 vmware상에 설치합니다.<br> <img src="/assets/img/2020-05-25-20-18-04.9650c813.png" alt=""></p></li> <li><p>OS에 맞는 설치 openshift-install, Pull secret값, RHCOS, OC CLI를 다운로드 합니다.
<img src="/assets/img/2020-05-25-20-18-38.b4cf6c46.png" alt=""></p></li> <li><p>openshift-install, OC가 잘 설치되었는지 확인합니다.
<img src="/assets/img/2020-05-25-03-04-42.29d23f85.png" alt=""></p></li></ul> <h2 id="설치-작업-디렉토리-생성"><a href="#설치-작업-디렉토리-생성" class="header-anchor">#</a> 설치 작업 디렉토리 생성</h2> <p>install-config.yaml과 ignition파일들이 생성될 설치 작업 디렉토리를 생성합니다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ mkdir -p /install/config
</code></pre></div><h2 id="install-config-yaml-생성"><a href="#install-config-yaml-생성" class="header-anchor">#</a> install-config.yaml 생성</h2> <p><a href="https://docs.openshift.com/container-platform/4.3/installing/installing_vsphere/installing-vsphere.html#installation-vsphere-config-yaml_installing-vsphere" target="_blank" rel="noopener noreferrer">Sample install-config.yaml<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>파일을 참조하여 작성합니다.</p> <div class="language- extra-class"><pre class="language-text"><code>Sample

apiVersion: v1
baseDomain: darumtech.net 
compute:
- hyperthreading: Enabled   
  name: worker
  replicas: 2 
controlPlane:
  hyperthreading: Enabled   
  name: master
  replicas: 3 
metadata:
  name: cp 
platform:
  vsphere:
    vcenter: your.vcenter.server 
    username: username 
    password: password 
    datacenter: datacenter 
    defaultDatastore: datastore 
fips: false 
pullSecret: '{&quot;auths&quot;: ...}' 
sshKey: 'ssh-ed25519 AAAA...' 
</code></pre></div><p>각 항목 설정방법은 아래와 같습니다.</p> <table><thead><tr><th style="text-align:left;">항목</th> <th style="text-align:left;">설명</th> <th style="text-align:left;">예</th></tr></thead> <tbody><tr><td style="text-align:left;">baseDomain</td> <td style="text-align:left;">기본 도메인</td> <td style="text-align:left;">kubepia.com</td></tr> <tr><td style="text-align:left;">compute.replicas</td> <td style="text-align:left;">worker node 수</td> <td style="text-align:left;">2</td></tr> <tr><td style="text-align:left;">controlPlane.replicas</td> <td style="text-align:left;">master node 수(3이상의 홀수)</td> <td style="text-align:left;">3</td></tr> <tr><td style="text-align:left;">metadata.name</td> <td style="text-align:left;">클러스터 이름. [name].[baseDomain]으로 기본 주소 사용됨</td> <td style="text-align:left;">cp</td></tr> <tr><td style="text-align:left;">platform.vsphere.vcenter</td> <td style="text-align:left;">vSphere vCenter hostname 또는 IP</td> <td style="text-align:left;">192.168.0.70</td></tr> <tr><td style="text-align:left;">platform.vsphere.username</td> <td style="text-align:left;">vSphere의 username</td> <td style="text-align:left;">administrator@vsphere.local</td></tr> <tr><td style="text-align:left;">platform.vsphere.password</td> <td style="text-align:left;">vSphere의 password</td> <td style="text-align:left;">passw0rd$</td></tr> <tr><td style="text-align:left;">platform.vsphere.datacenter</td> <td style="text-align:left;">vSphere Datacenter명</td> <td style="text-align:left;">NX-DC</td></tr> <tr><td style="text-align:left;">platform.vsphere.defaultDatastore</td> <td style="text-align:left;">vSphere의 기본 Datastore</td> <td style="text-align:left;">VMware-NFS</td></tr> <tr><td style="text-align:left;">fips</td> <td style="text-align:left;">Disk 암호화 사용 여부</td> <td style="text-align:left;">false</td></tr> <tr><td style="text-align:left;">pullSecret</td> <td style="text-align:left;">site별 SSL token값. 위 설치프로그램 다운로드 시 저장한 pullSecret파일 내용을 붙여넣게 합니다.</td> <td style="text-align:left;">생략</td></tr> <tr><td style="text-align:left;">sshKey</td> <td style="text-align:left;"><a href="https://kubepia.github.io/cloudpak/cp4app/install/infra08.html" target="_blank" rel="noopener noreferrer">SSHKey 구성<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>시 생성한 public key파일 내용</td> <td style="text-align:left;">생략</td></tr></tbody></table> <blockquote><p>defaultDatastore확인 <br> <img src="/assets/img/2020-05-25-20-38-45.f6a4199c.png" alt=""></p></blockquote> <p><img src="/assets/img/2020-05-25-20-53-49.8cba5f83.png" alt=""></p> <div class="custom-block tip"><p class="custom-block-title">반드시 install-config.yaml 백업</p> <p>install-config.yaml파일은 OCP 설치를 시작하면 없어집니다.<br>
반드시 백업파일을 생성하시기 바랍니다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ cp install-config.yaml install-config-org.yaml
</code></pre></div><p><img src="/assets/img/2020-05-25-20-56-29.601b6555.png" alt=""></p></div> <h2 id="install-manifest파일-생성-및-수정"><a href="#install-manifest파일-생성-및-수정" class="header-anchor">#</a> install manifest파일 생성 및 수정</h2> <p>설치 관련 설정 내용을 담고 있는 manifest파일들을 생성합니다.<br>
이 단계는 특별히 수정할게 없으면 생략해도 됩니다.<br>
'installation_directory'는 install-config.yaml파일이 있는 디렉토리입니다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ openshift-install create manifests --dir=&lt;installation_directory&gt;
</code></pre></div><p><img src="/assets/img/2020-05-25-21-05-20.f6d301fa.png" alt=""></p> <p>manifest파일들은 &lt;installation_directory&gt;/manifests디렉토리에 생성됩니다.<br> <img src="/assets/img/2020-05-25-21-06-39.1bf9d754.png" alt=""></p> <p>'cluster-scheduler-02-config.yml'파일에서 'mastersSchedulable'의 값을 'false'로 변경합니다.<br>
Master node에 Pod가 배포되지 않도록 하기 위함입니다.<br> <img src="/assets/img/2020-05-25-21-08-19.7b27ea69.png" alt=""></p> <h2 id="ignition-파일-생성"><a href="#ignition-파일-생성" class="header-anchor">#</a> ignition 파일 생성</h2> <p>RHCOS 부팅 시 참조하는 ignition파일들을 생성합니다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ openshift-install create ignition-configs --dir=&lt;installation_directory&gt; 

아래와 같은 구조로 파일들이 생성됩니다.  
auth/kubeadmin-password는 kubeadmin사용자의 암호이고,  
auth/kubeconfig는 cluster로그인 설정정보입니다.  
kubeconfig파일은 사용할 Terminal의 &lt;HOME&gt;/.kube/config파일로 복사하면  
cluster에 인증되어 접근할 수 있습니다.   
.
├── auth
│   ├── kubeadmin-password
│   └── kubeconfig
├── bootstrap.ign
├── master.ign
├── metadata.json
└── worker.ign
</code></pre></div><h2 id="append-bootstrap-ign파일-생성"><a href="#append-bootstrap-ign파일-생성" class="header-anchor">#</a> append-bootstrap.ign파일 생성</h2> <p>각 Node용 VM을 생성할 때 ignition파일의 내용을 base64 encoding하여 셋팅하여야 합니다.<br>
그런데 bootstrap.ign의 내용이 너무 많아 길이 제한에 걸려<br>
base64 encoding한 값을 셋팅할 수 없습니다.<br>
그래서 bootstrap.ign파일을 Web서버에 업로드하고,<br>
그 주소를 지정한 append-bootstrap.ign파일을 생성하여 셋팅합니다.</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;ignition&quot;: {
    &quot;config&quot;: {
      &quot;append&quot;: [
        {
          &quot;source&quot;: &quot;&lt;bootstrap_ignition_config_url&gt;&quot;, 
          &quot;verification&quot;: {}
        }
      ]
    },
    &quot;timeouts&quot;: {},
    &quot;version&quot;: &quot;2.1.0&quot;
  },
  &quot;networkd&quot;: {},
  &quot;passwd&quot;: {},
  &quot;storage&quot;: {},
  &quot;systemd&quot;: {}
}
</code></pre></div><ul><li><p>bootstrap VM에 <a href="https://kubepia.github.io/cloudpak/cp4app/install/infra02.html" target="_blank" rel="noopener noreferrer">Web서버가 설치<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>되어 있습니다.<br>
home디렉토리인 /var/www/html하위에 install디렉토리를 만들고 bootstrap.ign파일을 복사합니다.<br> <img src="/assets/img/2020-05-25-21-27-39.c1a10f7b.png" alt=""></p></li> <li><p>아래 예제와 같이 bootstrap.ign파일의 주소를 지정합니다.<br> <img src="/assets/img/2020-05-25-21-20-31.7621d6a5.png" alt=""></p></li></ul> <h2 id="ignition파일-base64-encoding"><a href="#ignition파일-base64-encoding" class="header-anchor">#</a> ignition파일 base64 encoding</h2> <p>base64 encoding한 ignition파일들을 생성합니다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ base64 -w0 &lt;installation_directory&gt;/master.ign &gt; &lt;installation_directory&gt;/master.64
$ base64 -w0 &lt;installation_directory&gt;/worker.ign &gt; &lt;installation_directory&gt;/worker.64
$ base64 -w0 &lt;installation_directory&gt;/append-bootstrap.ign &gt; &lt;installation_directory&gt;/append-bootstrap.64
</code></pre></div><p><img src="/assets/img/2020-05-25-21-28-11.40838593.png" alt=""></p> <h2 id="vm-template-작성"><a href="#vm-template-작성" class="header-anchor">#</a> VM Template 작성</h2> <p>각 Node VM을 만들 VM Template을 생성합니다.</p> <ul><li><p><strong>RHCOS image인 ova파일을 다운로드 합니다.</strong></p> <ul><li><a href="https://cloud.redhat.com/openshift/install" target="_blank" rel="noopener noreferrer">Redhat 설치페이지<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>을 로그인</li> <li>설치할 IaaS선택. 이 매뉴얼에서는 vmware선택</li> <li>'Red Hat Enterprise Linux CoreOS (RHCOS)'의 [Download RHCOS] 버튼 클릭</li> <li>'rhcos-[version]-x86_64-vmware.x86_64.ova'클릭하여 다운로드<br> <img src="/assets/img/2020-05-25-22-38-31.3e253d1c.png" alt=""></li></ul></li> <li><p><strong>작업폴더를 생성합니다.</strong></p> <ul><li>vSphere Client로그인</li> <li>좌측에서 'VMs and Templates' 탭 클릭-&gt;우측마우스메뉴에서 'New Folder &gt; New VM and Template Folder'선택  
<img src="/assets/img/2020-05-25-22-42-06.2dccfcc8.png" alt=""></li> <li>install-config.yaml의 'platform.vsphere.datacenter'에 입력한 datacenter명 입력<br> <img src="/assets/img/2020-05-25-22-44-22.e65220f0.png" alt=""></li> <li>위 작성한 datacenter선택-&gt;우측마우스메뉴에서 'New Folder'클릭<br> <img src="/assets/img/2020-05-25-22-47-04.afff032c.png" alt=""></li> <li>'templates'폴더 생성<br> <img src="/assets/img/2020-05-25-22-48-12.6ff660de.png" alt=""></li></ul></li> <li><p><strong>VM Template을 작성합니다.</strong></p> <ul><li>PC에 다운로드한 ova파일을 복사-붙여넣기하여 vcenter vm으로 복사</li> <li>'templates'폴더 선택-&gt;우측마우스메뉴에서 'Deploy OVF Template'클릭<br> <img src="/assets/img/2020-05-25-22-49-12.452cb92a.png" alt=""></li> <li>'Local file'선택하고 ova파일 위치 지정<br> <img src="/assets/img/2020-05-25-22-50-42.37a73a4a.png" alt=""></li> <li>template명과 folder선택<br> <img src="/assets/img/2020-05-25-22-53-22.cd899c69.png" alt=""></li> <li>Compute resource는 아무거나 선택<br> <img src="/assets/img/2020-05-25-22-54-08.c41e9727.png" alt=""></li> <li>선택내용 review<br> <img src="/assets/img/2020-05-25-22-55-37.79b5164a.png" alt=""></li> <li>Virtual Disk format은 'Thin Provision'선택하고 Storage선택<br> <img src="/assets/img/2020-05-25-22-57-31.84bb112f.png" alt=""></li> <li>Network은 'VM Network'선택<br> <img src="/assets/img/2020-05-25-22-58-28.4bc2d7e4.png" alt=""></li> <li>'Customize template'은 Skip함<br> <img src="/assets/img/2020-05-25-22-59-12.3c4b7b3f.png" alt=""></li> <li>'Ready to complete'에서 마지막으로 설정 내용 검토하고 [FINISH]클릭<br> <img src="/assets/img/2020-05-25-23-00-36.51bd69a0.png" alt=""></li> <li>생성된 VM선택-&gt;우측마우스메뉴에서 'Template-&gt;Convert to template'클릭<br> <img src="/assets/img/2020-05-25-23-02-59.a763f695.png" alt=""></li></ul></li></ul> <h2 id="bootstrap-node-vm-생성"><a href="#bootstrap-node-vm-생성" class="header-anchor">#</a> Bootstrap Node VM 생성</h2> <p>bootstrap node VM을 생성합니다.</p> <h2 id="master-node-vm-생성"><a href="#master-node-vm-생성" class="header-anchor">#</a> Master Node VM 생성</h2> <h2 id="worker-node-vm-생성"><a href="#worker-node-vm-생성" class="header-anchor">#</a> Worker Node VM 생성</h2></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/cloudpak/cp4app/install/infra09.html" class="prev">
        Infra Servers-iptables 설치
      </a></span> <span class="next"><a href="/cloudpak/cp4app/install/ocp02.html">
        OCP-OCP설치
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.bf8a7b73.js" defer></script><script src="/assets/js/2.dcea4fc4.js" defer></script><script src="/assets/js/3.c3678dfd.js" defer></script>
  </body>
</html>
