<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OCP-ignition파일 및 VM생성 | Kubepia Documents</title>
    <meta name="description" content="Technical guidelines about kubernetes">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png">
  <link rel="manifest" href="/assets/favicons/site.webmanifest">
    
    <link rel="preload" href="/assets/css/0.styles.6963f482.css" as="style"><link rel="preload" href="/assets/js/app.9eff8916.js" as="script"><link rel="preload" href="/assets/js/2.896d939f.js" as="script"><link rel="preload" href="/assets/js/4.f3f6e351.js" as="script"><link rel="preload" href="/assets/js/21.b086e9ea.js" as="script"><link rel="prefetch" href="/assets/js/10.e81b89e1.js"><link rel="prefetch" href="/assets/js/11.ac825488.js"><link rel="prefetch" href="/assets/js/12.4130533e.js"><link rel="prefetch" href="/assets/js/13.86307c39.js"><link rel="prefetch" href="/assets/js/14.2d7c5cf0.js"><link rel="prefetch" href="/assets/js/15.91d590ba.js"><link rel="prefetch" href="/assets/js/16.7f834bd6.js"><link rel="prefetch" href="/assets/js/17.2d0dc397.js"><link rel="prefetch" href="/assets/js/18.05726fef.js"><link rel="prefetch" href="/assets/js/19.e869ed96.js"><link rel="prefetch" href="/assets/js/20.22be9991.js"><link rel="prefetch" href="/assets/js/22.6e2e5938.js"><link rel="prefetch" href="/assets/js/23.ea8a9670.js"><link rel="prefetch" href="/assets/js/24.4b082b94.js"><link rel="prefetch" href="/assets/js/25.22da100c.js"><link rel="prefetch" href="/assets/js/26.e9cc0be8.js"><link rel="prefetch" href="/assets/js/27.89af4424.js"><link rel="prefetch" href="/assets/js/28.c2a9cf4e.js"><link rel="prefetch" href="/assets/js/29.33f2f096.js"><link rel="prefetch" href="/assets/js/3.3f113366.js"><link rel="prefetch" href="/assets/js/30.83440de5.js"><link rel="prefetch" href="/assets/js/31.dda2018c.js"><link rel="prefetch" href="/assets/js/32.f0a29408.js"><link rel="prefetch" href="/assets/js/33.23ae0a4c.js"><link rel="prefetch" href="/assets/js/34.a5e52561.js"><link rel="prefetch" href="/assets/js/35.ca446cfa.js"><link rel="prefetch" href="/assets/js/36.9a76d2d6.js"><link rel="prefetch" href="/assets/js/37.fc9f1379.js"><link rel="prefetch" href="/assets/js/38.873d2bf3.js"><link rel="prefetch" href="/assets/js/39.b8980e01.js"><link rel="prefetch" href="/assets/js/40.f10b668d.js"><link rel="prefetch" href="/assets/js/41.3c407481.js"><link rel="prefetch" href="/assets/js/5.ba8f8586.js"><link rel="prefetch" href="/assets/js/6.193addc8.js"><link rel="prefetch" href="/assets/js/7.60aa97c8.js"><link rel="prefetch" href="/assets/js/8.6f2831a4.js"><link rel="prefetch" href="/assets/js/9.8df0cb05.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6963f482.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/kubepia.png" alt="Kubepia Documents" class="logo"> <span class="site-name can-hide">Kubepia Documents</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/devops/overview.html" class="nav-link">
  DevOps
</a></div><div class="nav-item"><a href="/k8s/" class="nav-link">
  K8S
</a></div><div class="nav-item"><a href="/ocp/overview.html" class="nav-link">
  OCP4.X
</a></div><div class="nav-item"><a href="/cloudpak/overview.html" class="nav-link">
  CloudPak
</a></div><div class="nav-item"><a href="/architecture/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="/aboutus/iamnogada.html" class="nav-link">
  About US
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/devops/overview.html" class="nav-link">
  DevOps
</a></div><div class="nav-item"><a href="/k8s/" class="nav-link">
  K8S
</a></div><div class="nav-item"><a href="/ocp/overview.html" class="nav-link">
  OCP4.X
</a></div><div class="nav-item"><a href="/cloudpak/overview.html" class="nav-link">
  CloudPak
</a></div><div class="nav-item"><a href="/architecture/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="/aboutus/iamnogada.html" class="nav-link">
  About US
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>CloudPak</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/cloudpak/cp4app/overview" class="sidebar-heading clickable open"><span>CP4App</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading open"><span>Install</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cloudpak/cp4app/install/infra01.html" class="sidebar-link">Infra Servers-VM 생성</a></li><li><a href="/cloudpak/cp4app/install/infra02.html" class="sidebar-link">Infra Servers-Web서버 설치</a></li><li><a href="/cloudpak/cp4app/install/infra03.html" class="sidebar-link">Infra Servers-VM Network 설정</a></li><li><a href="/cloudpak/cp4app/install/infra04.html" class="sidebar-link">Infra Servers-DNS서버 설치</a></li><li><a href="/cloudpak/cp4app/install/infra05.html" class="sidebar-link">Infra Servers-HAProxy서버 설치</a></li><li><a href="/cloudpak/cp4app/install/infra06.html" class="sidebar-link">Infra Servers-DHCP서버 설치</a></li><li><a href="/cloudpak/cp4app/install/infra07.html" class="sidebar-link">Infra Servers-NFS서버 설치</a></li><li><a href="/cloudpak/cp4app/install/infra08.html" class="sidebar-link">Infra Servers-SSLKey 구성</a></li><li><a href="/cloudpak/cp4app/install/infra09.html" class="sidebar-link">Infra Servers-iptables 설치</a></li><li><a href="/cloudpak/cp4app/install/ocp01.html" class="active sidebar-link">OCP-ignition파일 및 VM생성</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#사전준비" class="sidebar-link">사전준비</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#설치-프로그램-다운로드" class="sidebar-link">설치 프로그램 다운로드</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#설치-작업-디렉토리-생성" class="sidebar-link">설치 작업 디렉토리 생성</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#install-config-yaml-생성" class="sidebar-link">install-config.yaml 생성</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#install-manifest파일-생성-및-수정" class="sidebar-link">install manifest파일 생성 및 수정</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#ignition-파일-생성" class="sidebar-link">ignition 파일 생성</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#append-bootstrap-ign파일-생성" class="sidebar-link">append-bootstrap.ign파일 생성</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#ignition파일-base64-encoding" class="sidebar-link">ignition파일 base64 encoding</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#vm-template-작성" class="sidebar-link">VM Template 작성</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#master-node-vm-생성" class="sidebar-link">Master Node VM 생성</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#worker-node-vm-생성" class="sidebar-link">Worker Node VM 생성</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#bootstrap-node-vm-생성" class="sidebar-link">Bootstrap Node VM 생성</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp01.html#snapshot-만들기" class="sidebar-link">Snapshot 만들기</a></li></ul></li><li><a href="/cloudpak/cp4app/install/ocp02.html" class="sidebar-link">OCP-OCP설치</a></li><li><a href="/cloudpak/cp4app/install/ocp03.html" class="sidebar-link">OCP-Local Image Registry 구성</a></li><li><a href="/cloudpak/cp4app/install/ocp04.html" class="sidebar-link">OCP-NFS Dynamic provisioning</a></li><li><a href="/cloudpak/cp4app/install/ocp05.html" class="sidebar-link">OCP-IdP 추가</a></li><li><a href="/cloudpak/cp4app/install/cp4app01.html" class="sidebar-link">CP4App-Common Service 설치</a></li><li><a href="/cloudpak/cp4app/install/cp4app02.html" class="sidebar-link">CP4App-CP4App 설치</a></li></ul></section></li></ul></section></li><li><a href="/cloudpak/cp4mm/overview.html" class="sidebar-link">CP4MM</a></li><li><a href="/cloudpak/md-sample.html" class="sidebar-link">Markdown sample</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ocp-ignition파일-및-vm생성"><a href="#ocp-ignition파일-및-vm생성" class="header-anchor">#</a> OCP-ignition파일 및 VM생성</h1> <div class="custom-block tip"><p class="custom-block-title">TASK DESCRIPTION</p> <p>ignition파일은 RHCOS(RedHat Core OS)가 실행될때 참조하는 제반설정정보입니다.<br>
openshift-install명령을 이용하여 ignition 파일을 생성합니다.<br>
생성된 파일의 내용을 base64로 암호화하여 VM Node의 속성으로 등록합니다.<br>
버전별 설치가이드를 참고하십시오.</p> <ul><li><a href="https://docs.openshift.com/container-platform/4.3/installing/installing_vsphere/installing-vsphere.html" target="_blank" rel="noopener noreferrer">OCP4.3 install 가이드<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.openshift.com/container-platform/4.4/installing/installing_vsphere/installing-vsphere.html" target="_blank" rel="noopener noreferrer">OCP4.4 install 가이드<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
본 설치매뉴얼은 vmware vSphere상의 설치를 위해 작성되었습니다.</li></ul> <p></p><div class="table-of-contents"><ul><li><a href="#사전준비">사전준비</a></li><li><a href="#설치-프로그램-다운로드">설치 프로그램 다운로드</a></li><li><a href="#설치-작업-디렉토리-생성">설치 작업 디렉토리 생성</a></li><li><a href="#install-config-yaml-생성">install-config.yaml 생성</a></li><li><a href="#install-manifest파일-생성-및-수정">install manifest파일 생성 및 수정</a></li><li><a href="#ignition-파일-생성">ignition 파일 생성</a></li><li><a href="#append-bootstrap-ign파일-생성">append-bootstrap.ign파일 생성</a></li><li><a href="#ignition파일-base64-encoding">ignition파일 base64 encoding</a></li><li><a href="#vm-template-작성">VM Template 작성</a></li><li><a href="#master-node-vm-생성">Master Node VM 생성</a></li><li><a href="#worker-node-vm-생성">Worker Node VM 생성</a></li><li><a href="#bootstrap-node-vm-생성">Bootstrap Node VM 생성</a></li><li><a href="#snapshot-만들기">Snapshot 만들기</a></li></ul></div><p></p></div> <h2 id="사전준비"><a href="#사전준비" class="header-anchor">#</a> 사전준비</h2> <ul><li><p><strong>vSphere버전</strong><br>
vSphere 6.5상에도 설치가능하지만 vSphere Version 6.7 U2이상을 권장합니다.</p></li> <li><p><strong>System requirements</strong>
문서상의 최소 사양은 아래와 같습니다.<br> <img src="/assets/img/2020-05-25-02-38-00.defb37ee.png" alt=""></p></li></ul> <p>경험상 CP4App까지 설치하여 운영하기 위한 사양은 아래와 같습니다.</p> <table><thead><tr><th style="text-align:left;">Machine</th> <th style="text-align:left;">vCPU</th> <th style="text-align:left;">vRAM</th> <th style="text-align:left;">Storage</th></tr></thead> <tbody><tr><td style="text-align:left;">Bootstrap</td> <td style="text-align:left;">8</td> <td style="text-align:left;">16</td> <td style="text-align:left;">120</td></tr> <tr><td style="text-align:left;">Control plane</td> <td style="text-align:left;">8</td> <td style="text-align:left;">32</td> <td style="text-align:left;">120</td></tr> <tr><td style="text-align:left;">Compute</td> <td style="text-align:left;">16</td> <td style="text-align:left;">32</td> <td style="text-align:left;">120</td></tr></tbody></table> <p>Master Node는 최소 3개이상, Worker Node는 최소 2개 이상 필요합니다.</p> <ul><li><strong>User Provisioned Infra 환경 준비</strong><br>
아래와 같은 인프라 환경구성이 필요합니다.
<ul><li>Network connections</li> <li>DNS</li> <li>L/B</li> <li>DHCP</li> <li>Configure Ports
참조: <a href="https://docs.openshift.com/container-platform/4.3/installing/installing_vsphere/installing-vsphere.html#installation-network-user-infra_installing-vsphere" target="_blank" rel="noopener noreferrer">User provisioned infrastructure<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <h2 id="설치-프로그램-다운로드"><a href="#설치-프로그램-다운로드" class="header-anchor">#</a> 설치 프로그램 다운로드</h2> <ul><li><p>**<a href="https://cloud.redhat.com/openshift/install" target="_blank" rel="noopener noreferrer">Redhat 설치 가이드<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>**으로 로그인합니다.<br>
그리고 설치 인프라 환경을 선택하십시오.  본 매뉴얼에서는 vmware상에 설치합니다.<br> <img src="/assets/img/2020-05-25-20-18-04.9650c813.png" alt=""></p></li> <li><p>OS에 맞는 설치 openshift-install, Pull secret값, RHCOS, OC CLI를 다운로드 합니다.
<img src="/assets/img/2020-05-25-20-18-38.b4cf6c46.png" alt=""></p></li> <li><p>openshift-install, OC가 잘 설치되었는지 확인합니다.
<img src="/assets/img/2020-05-25-03-04-42.29d23f85.png" alt=""></p></li></ul> <h2 id="설치-작업-디렉토리-생성"><a href="#설치-작업-디렉토리-생성" class="header-anchor">#</a> 설치 작업 디렉토리 생성</h2> <p>install-config.yaml과 ignition파일들이 생성될 설치 작업 디렉토리를 생성합니다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ mkdir -p /install/config
</code></pre></div><h2 id="install-config-yaml-생성"><a href="#install-config-yaml-생성" class="header-anchor">#</a> install-config.yaml 생성</h2> <p><a href="https://docs.openshift.com/container-platform/4.3/installing/installing_vsphere/installing-vsphere.html#installation-vsphere-config-yaml_installing-vsphere" target="_blank" rel="noopener noreferrer">Sample install-config.yaml<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>파일을 참조하여 작성합니다.</p> <div class="language- extra-class"><pre class="language-text"><code>Sample

apiVersion: v1
baseDomain: darumtech.net 
compute:
- hyperthreading: Enabled   
  name: worker
  replicas: 2 
controlPlane:
  hyperthreading: Enabled   
  name: master
  replicas: 3 
metadata:
  name: cp 
platform:
  vsphere:
    vcenter: your.vcenter.server 
    username: username 
    password: password 
    datacenter: datacenter 
    defaultDatastore: datastore 
fips: false 
pullSecret: '{&quot;auths&quot;: ...}' 
sshKey: 'ssh-ed25519 AAAA...' 
</code></pre></div><p>각 항목 설정방법은 아래와 같습니다.</p> <table><thead><tr><th style="text-align:left;">항목</th> <th style="text-align:left;">설명</th> <th style="text-align:left;">예</th></tr></thead> <tbody><tr><td style="text-align:left;">baseDomain</td> <td style="text-align:left;">기본 도메인</td> <td style="text-align:left;">kubepia.com</td></tr> <tr><td style="text-align:left;">compute.replicas</td> <td style="text-align:left;">worker node 수</td> <td style="text-align:left;">2</td></tr> <tr><td style="text-align:left;">controlPlane.replicas</td> <td style="text-align:left;">master node 수(3이상의 홀수)</td> <td style="text-align:left;">3</td></tr> <tr><td style="text-align:left;">metadata.name</td> <td style="text-align:left;">클러스터 이름. [name].[baseDomain]으로 기본 주소 사용됨</td> <td style="text-align:left;">cp</td></tr> <tr><td style="text-align:left;">platform.vsphere.vcenter</td> <td style="text-align:left;">vSphere vCenter hostname 또는 IP</td> <td style="text-align:left;">192.168.0.70</td></tr> <tr><td style="text-align:left;">platform.vsphere.username</td> <td style="text-align:left;">vSphere의 username</td> <td style="text-align:left;">administrator@vsphere.local</td></tr> <tr><td style="text-align:left;">platform.vsphere.password</td> <td style="text-align:left;">vSphere의 password</td> <td style="text-align:left;">passw0rd$</td></tr> <tr><td style="text-align:left;">platform.vsphere.datacenter</td> <td style="text-align:left;">vSphere Datacenter명</td> <td style="text-align:left;">NX-DC</td></tr> <tr><td style="text-align:left;">platform.vsphere.defaultDatastore</td> <td style="text-align:left;">vSphere의 기본 Datastore</td> <td style="text-align:left;">VMware-NFS</td></tr> <tr><td style="text-align:left;">fips</td> <td style="text-align:left;">Disk 암호화 사용 여부</td> <td style="text-align:left;">false</td></tr> <tr><td style="text-align:left;">pullSecret</td> <td style="text-align:left;">site별 SSL token값. 위 설치프로그램 다운로드 시 저장한 pullSecret파일 내용을 붙여넣게 합니다.</td> <td style="text-align:left;">생략</td></tr> <tr><td style="text-align:left;">sshKey</td> <td style="text-align:left;"><a href="https://kubepia.github.io/cloudpak/cp4app/install/infra08.html" target="_blank" rel="noopener noreferrer">SSHKey 구성<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>시 생성한 public key파일 내용</td> <td style="text-align:left;">생략</td></tr></tbody></table> <blockquote><p>defaultDatastore확인 <br> <img src="/assets/img/2020-05-25-20-38-45.f6a4199c.png" alt=""></p></blockquote> <p><img src="/assets/img/2020-05-25-20-53-49.8cba5f83.png" alt=""></p> <div class="custom-block tip"><p class="custom-block-title">반드시 install-config.yaml 백업</p> <p>install-config.yaml파일은 OCP 설치를 시작하면 없어집니다.<br>
반드시 백업파일을 생성하시기 바랍니다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ cp install-config.yaml install-config-org.yaml
</code></pre></div><p><img src="/assets/img/2020-05-25-20-56-29.601b6555.png" alt=""></p></div> <h2 id="install-manifest파일-생성-및-수정"><a href="#install-manifest파일-생성-및-수정" class="header-anchor">#</a> install manifest파일 생성 및 수정</h2> <p>설치 관련 설정 내용을 담고 있는 manifest파일들을 생성합니다.<br>
이 단계는 특별히 수정할게 없으면 생략해도 됩니다.<br>
'installation_directory'는 install-config.yaml파일이 있는 디렉토리입니다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ openshift-install create manifests --dir=&lt;installation_directory&gt;
</code></pre></div><p><img src="/assets/img/2020-05-25-21-05-20.f6d301fa.png" alt=""></p> <p>manifest파일들은 &lt;installation_directory&gt;/manifests디렉토리에 생성됩니다.<br> <img src="/assets/img/2020-05-25-21-06-39.1bf9d754.png" alt=""></p> <p>'cluster-scheduler-02-config.yml'파일에서 'mastersSchedulable'의 값을 'false'로 변경합니다.<br>
Master node에 Pod가 배포되지 않도록 하기 위함입니다.<br> <img src="/assets/img/2020-05-25-21-08-19.7b27ea69.png" alt=""></p> <h2 id="ignition-파일-생성"><a href="#ignition-파일-생성" class="header-anchor">#</a> ignition 파일 생성</h2> <p>RHCOS 부팅 시 참조하는 ignition파일들을 생성합니다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ openshift-install create ignition-configs --dir=&lt;installation_directory&gt; 

아래와 같은 구조로 파일들이 생성됩니다.  
auth/kubeadmin-password는 kubeadmin사용자의 암호이고,  
auth/kubeconfig는 cluster로그인 설정정보입니다.  
kubeconfig파일은 사용할 Terminal의 &lt;HOME&gt;/.kube/config파일로 복사하면  
cluster에 인증되어 접근할 수 있습니다.   
.
├── auth
│   ├── kubeadmin-password
│   └── kubeconfig
├── bootstrap.ign
├── master.ign
├── metadata.json
└── worker.ign
</code></pre></div><h2 id="append-bootstrap-ign파일-생성"><a href="#append-bootstrap-ign파일-생성" class="header-anchor">#</a> append-bootstrap.ign파일 생성</h2> <p>각 Node용 VM을 생성할 때 ignition파일의 내용을 base64 encoding하여 셋팅하여야 합니다.<br>
그런데 bootstrap.ign의 내용이 너무 많아 길이 제한에 걸려<br>
base64 encoding한 값을 셋팅할 수 없습니다.<br>
그래서 bootstrap.ign파일을 Web서버에 업로드하고,<br>
그 주소를 지정한 append-bootstrap.ign파일을 생성하여 셋팅합니다.</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;ignition&quot;: {
    &quot;config&quot;: {
      &quot;append&quot;: [
        {
          &quot;source&quot;: &quot;&lt;bootstrap_ignition_config_url&gt;&quot;, 
          &quot;verification&quot;: {}
        }
      ]
    },
    &quot;timeouts&quot;: {},
    &quot;version&quot;: &quot;2.1.0&quot;
  },
  &quot;networkd&quot;: {},
  &quot;passwd&quot;: {},
  &quot;storage&quot;: {},
  &quot;systemd&quot;: {}
}
</code></pre></div><ul><li><p>bootstrap VM에 <a href="https://kubepia.github.io/cloudpak/cp4app/install/infra02.html" target="_blank" rel="noopener noreferrer">Web서버가 설치<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>되어 있습니다.<br>
home디렉토리인 /var/www/html하위에 install디렉토리를 만들고 bootstrap.ign파일을 복사합니다.<br> <img src="/assets/img/2020-05-25-21-27-39.c1a10f7b.png" alt=""></p></li> <li><p>아래 예제와 같이 bootstrap.ign파일의 주소를 지정합니다.<br> <img src="/assets/img/2020-05-25-21-20-31.7621d6a5.png" alt=""></p></li></ul> <h2 id="ignition파일-base64-encoding"><a href="#ignition파일-base64-encoding" class="header-anchor">#</a> ignition파일 base64 encoding</h2> <p>base64 encoding한 ignition파일들을 생성합니다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ base64 -w0 &lt;installation_directory&gt;/master.ign &gt; &lt;installation_directory&gt;/master.64
$ base64 -w0 &lt;installation_directory&gt;/worker.ign &gt; &lt;installation_directory&gt;/worker.64
$ base64 -w0 &lt;installation_directory&gt;/append-bootstrap.ign &gt; &lt;installation_directory&gt;/append-bootstrap.64
</code></pre></div><p><img src="/assets/img/2020-05-25-21-28-11.40838593.png" alt=""></p> <h2 id="vm-template-작성"><a href="#vm-template-작성" class="header-anchor">#</a> VM Template 작성</h2> <p>각 Node VM을 만들 VM Template을 생성합니다.</p> <ul><li><p><strong>RHCOS image인 ova파일을 다운로드 합니다.</strong></p> <ul><li><a href="https://cloud.redhat.com/openshift/install" target="_blank" rel="noopener noreferrer">Redhat 설치페이지<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>을 로그인</li> <li>설치할 IaaS선택. 이 매뉴얼에서는 vmware선택</li> <li>'Red Hat Enterprise Linux CoreOS (RHCOS)'의 [Download RHCOS] 버튼 클릭</li> <li>'rhcos-[version]-x86_64-vmware.x86_64.ova'클릭하여 다운로드<br> <img src="/assets/img/2020-05-25-22-38-31.3e253d1c.png" alt=""></li></ul></li> <li><p><strong>작업폴더를 생성합니다.</strong></p> <ul><li>vSphere Client로그인</li> <li>좌측에서 'VMs and Templates' 탭 클릭-&gt;우측마우스메뉴에서 'New Folder &gt; New VM and Template Folder'선택  
<img src="/assets/img/2020-05-25-22-42-06.2dccfcc8.png" alt=""></li> <li>install-config.yaml의 'platform.vsphere.datacenter'에 입력한 datacenter명 입력<br> <img src="/assets/img/2020-05-25-22-44-22.e65220f0.png" alt=""></li> <li>위 작성한 datacenter선택-&gt;우측마우스메뉴에서 'New Folder'클릭<br> <img src="/assets/img/2020-05-25-22-47-04.afff032c.png" alt=""></li> <li>'templates'폴더 생성<br> <img src="/assets/img/2020-05-25-22-48-12.6ff660de.png" alt=""></li></ul></li> <li><p><strong>VM Template을 작성합니다.</strong></p> <ul><li>PC에 다운로드한 ova파일을 복사-붙여넣기하여 vcenter vm으로 복사</li> <li>'templates'폴더 선택-&gt;우측마우스메뉴에서 'Deploy OVF Template'클릭<br> <img src="/assets/img/2020-05-25-22-49-12.452cb92a.png" alt=""></li> <li>'Local file'선택하고 ova파일 위치 지정<br> <img src="/assets/img/2020-05-25-22-50-42.37a73a4a.png" alt=""></li> <li>template명과 folder선택<br> <img src="/assets/img/2020-05-25-22-53-22.cd899c69.png" alt=""></li> <li>Compute resource는 아무거나 선택<br> <img src="/assets/img/2020-05-25-22-54-08.c41e9727.png" alt=""></li> <li>선택내용 review<br> <img src="/assets/img/2020-05-25-22-55-37.79b5164a.png" alt=""></li> <li>Virtual Disk format은 'Thin Provision'선택하고 Storage선택<br> <img src="/assets/img/2020-05-25-22-57-31.84bb112f.png" alt=""></li> <li>Network은 'VM Network'선택<br> <img src="/assets/img/2020-05-25-22-58-28.4bc2d7e4.png" alt=""></li> <li>'Customize template'은 Skip함<br> <img src="/assets/img/2020-05-25-22-59-12.3c4b7b3f.png" alt=""></li> <li>'Ready to complete'에서 마지막으로 설정 내용 검토하고 [FINISH]클릭<br> <img src="/assets/img/2020-05-25-23-00-36.51bd69a0.png" alt=""></li> <li>생성된 VM선택-&gt;우측마우스메뉴에서 'Template-&gt;Convert to template'클릭<br> <img src="/assets/img/2020-05-25-23-02-59.a763f695.png" alt=""></li></ul></li></ul> <h2 id="master-node-vm-생성"><a href="#master-node-vm-생성" class="header-anchor">#</a> Master Node VM 생성</h2> <p>Master node VM을 생성합니다.</p> <ul><li><strong>VM template 선택 -&gt; 우측마우스메뉴에서 'New VM from This Template'클릭</strong><br> <img src="/assets/img/2020-05-25-23-12-11.c266d58b.png" alt=""></li> <li><strong>VM의 이름과 folder를 지정</strong><br> <img src="/assets/img/2020-05-25-23-15-29.2dc8882b.png" alt=""></li></ul> <blockquote><p><strong>VM이름</strong> <br>
VM이름의 규칙은 없지만 헷갈리지 않도록 <a href="https://kubepia.github.io/cloudpak/cp4app/install/infra06.html#dhcp%EC%84%9C%EB%B2%84-%EC%84%A4%EC%B9%98" target="_blank" rel="noopener noreferrer">dhcpd.conf파일에 지정<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>한 이름을 참조하여 작명하십시오.</p></blockquote> <ul><li><p><strong>'Compute resource'는 아무거나 지정하면 됨</strong><br> <a href="https://kubepia.github.io/cloudpak/cp4app/install/infra01.html#drs%EC%9E%90%EB%8F%99%ED%99%94-%EC%84%A4%EC%A0%95" target="_blank" rel="noopener noreferrer">DRS-Distributed Resources Scheduler<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>를 이용하므로 자동으로 IP가 부여됨<br> <img src="/assets/img/2020-05-25-23-28-01.ab22015d.png" alt=""></p></li> <li><p><strong>Storage선택</strong><br> <img src="/assets/img/2020-05-25-23-30-50.2e23526c.png" alt=""></p></li> <li><p><strong>'Customize this virtual machine's hardware'체크</strong><br> <img src="/assets/img/2020-05-25-23-31-34.c37b762e.png" alt=""></p></li> <li><p><strong>CPU/MEM/Disk 지정</strong><br> <a href="https://kubepia.github.io/cloudpak/cp4app/install/ocp01.html#%EC%82%AC%EC%A0%84%EC%A4%80%EB%B9%84" target="_blank" rel="noopener noreferrer">System requirements<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>를 참조하여 지정하세요.<br>
메모리 항목을 펼치고 'Reservation'을 동일하게 바꿔 주십시오.<br> <img src="/assets/img/2020-05-25-23-33-25.a8618b1c.png" alt=""></p></li> <li><p><strong>Network MAC Address지정</strong><br>
Network Adapter1을 펼치고 MAC Address항목의 'Automatic'을 'Manual'로 변경하십시오.<br>
MAC Address는 Network VM의 /etc/dhcpd.conf에 정의한 MAC주소를 입력하십시오.<br> <a href="https://kubepia.github.io/cloudpak/cp4app/install/infra06.html#dhcp%EC%84%9C%EB%B2%84-%EC%84%A4%EC%B9%98" target="_blank" rel="noopener noreferrer">dhcpd.conf파일 설정<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>을 참고 하십시오.<br> <img src="/assets/img/2020-05-25-23-39-27.f4220b88.png" alt=""></p></li> <li><p><strong>ignition내용 셋팅</strong><br>
RHCOS부팅시에 참조할 ignition값을 파라미터로 셋팅합니다.</p> <ul><li>'VM Options'탭을 클릭하고 'Configuration Parameters'의 [EDIT CONFIGURATION]을 클릭하십시오.<br> <img src="/assets/img/2020-05-25-23-43-15.4f07c362.png" alt=""></li> <li>[Add Configuration Params]버튼을 클릭하여 파라미터를 추가</li></ul> <table><thead><tr><th style="text-align:left;">파라미터</th> <th style="text-align:left;">값</th></tr></thead> <tbody><tr><td style="text-align:left;">guestinfo.ignition.config.data</td> <td style="text-align:left;">master.64파일 내용</td></tr> <tr><td style="text-align:left;">guestinfo.ignition.config.data.encoding</td> <td style="text-align:left;">base64</td></tr> <tr><td style="text-align:left;">disk.EnableUUID</td> <td style="text-align:left;">TRUE</td></tr></tbody></table> <p><img src="/assets/img/2020-05-25-23-51-53.737b9429.png" alt=""></p></li> <li><p><strong>설정내용 최종검토</strong><br>
최종 검토 후 [FINISH]버튼을 클릭합니다.<br> <img src="/assets/img/2020-05-25-23-52-59.576e31cb.png" alt=""></p></li></ul> <div class="custom-block tip"><p class="custom-block-title">모든 Master node VM 생성</p> <p>VM이름과 MAC Address만 다르게 하여 나머지 Master Node VM들을 생성합니다.</p></div> <h2 id="worker-node-vm-생성"><a href="#worker-node-vm-생성" class="header-anchor">#</a> Worker Node VM 생성</h2> <div class="custom-block tip"><p class="custom-block-title">Worker node VM 생성</p> <p>Master node VM생성단계를 참고하여 모든 Worker node VM들을 생성합니다.<br>
단, 아래 단계에서는 Worker node에 맞게 변경하여야 합니다.</p> <ul><li>VM의 이름과 folder를 지정</li> <li>CPU/MEM/Disk 지정</li> <li>Network MAC Address지정</li> <li>ignition내용 셋팅: worker.64파일 내용으로 셋팅</li></ul></div> <h2 id="bootstrap-node-vm-생성"><a href="#bootstrap-node-vm-생성" class="header-anchor">#</a> Bootstrap Node VM 생성</h2> <div class="custom-block tip"><p class="custom-block-title">Bootstrap node VM 생성</p> <p>Master node VM생성단계를 참고하여 Bootstrap node VM들을 생성합니다.<br>
단, 아래 단계에서는 Bootstrap node에 맞게 변경하여야 합니다.</p> <ul><li>VM의 이름과 folder를 지정</li> <li>CPU/MEM/Disk 지정</li> <li>Network MAC Address지정</li> <li>ignition내용 셋팅: append-bootstrap.64파일 내용으로 셋팅</li></ul></div> <h2 id="snapshot-만들기"><a href="#snapshot-만들기" class="header-anchor">#</a> Snapshot 만들기</h2> <p>지금까지 작업한 내용을 백업하기 위해 각 VM의 Snapshot을 생성합니다.<br> <img src="/assets/img/2020-05-26-00-04-28.d0901863.png" alt=""></p> <p><strong>※ Infra VM들은 중지하고 Snapshot을 생성하셔야 빠르게 snapshot이 만들어집니다.</strong></p> <hr> <div id="disqus_thread"></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/cloudpak/cp4app/install/infra09.html" class="prev">
        Infra Servers-iptables 설치
      </a></span> <span class="next"><a href="/cloudpak/cp4app/install/ocp02.html">
        OCP-OCP설치
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.9eff8916.js" defer></script><script src="/assets/js/2.896d939f.js" defer></script><script src="/assets/js/4.f3f6e351.js" defer></script><script src="/assets/js/21.b086e9ea.js" defer></script>
  </body>
</html>
