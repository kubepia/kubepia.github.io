<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OCP-IdP 추가 | Kubepia Documents</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png">
    <link rel="manifest" href="/assets/favicons/site.webmanifest">
    <meta name="description" content="Technical guidelines about kubernetes">
    <link rel="preload" href="/assets/css/0.styles.ffa6cac2.css" as="style"><link rel="preload" href="/assets/js/app.faac2083.js" as="script"><link rel="preload" href="/assets/js/3.8d0845ad.js" as="script"><link rel="preload" href="/assets/js/7.85e72874.js" as="script"><link rel="preload" href="/assets/js/28.82f53b83.js" as="script"><link rel="prefetch" href="/assets/js/10.281ad5c5.js"><link rel="prefetch" href="/assets/js/11.66bbddf0.js"><link rel="prefetch" href="/assets/js/12.0926029e.js"><link rel="prefetch" href="/assets/js/13.11b9b31f.js"><link rel="prefetch" href="/assets/js/14.099b36aa.js"><link rel="prefetch" href="/assets/js/15.829648f1.js"><link rel="prefetch" href="/assets/js/16.93a56327.js"><link rel="prefetch" href="/assets/js/17.6031f5c6.js"><link rel="prefetch" href="/assets/js/18.39546b5b.js"><link rel="prefetch" href="/assets/js/19.3771119b.js"><link rel="prefetch" href="/assets/js/2.4cdf62c8.js"><link rel="prefetch" href="/assets/js/20.b8122c5a.js"><link rel="prefetch" href="/assets/js/21.7bfefdde.js"><link rel="prefetch" href="/assets/js/22.d1d6175d.js"><link rel="prefetch" href="/assets/js/23.c5c8335a.js"><link rel="prefetch" href="/assets/js/24.1d2724e7.js"><link rel="prefetch" href="/assets/js/25.a5d1d131.js"><link rel="prefetch" href="/assets/js/26.3664d459.js"><link rel="prefetch" href="/assets/js/27.cfef3aff.js"><link rel="prefetch" href="/assets/js/29.d4d474e8.js"><link rel="prefetch" href="/assets/js/30.999c57bc.js"><link rel="prefetch" href="/assets/js/31.94b9a6fd.js"><link rel="prefetch" href="/assets/js/32.4df44036.js"><link rel="prefetch" href="/assets/js/33.2db4b991.js"><link rel="prefetch" href="/assets/js/34.c75cf700.js"><link rel="prefetch" href="/assets/js/35.028af99a.js"><link rel="prefetch" href="/assets/js/36.0ef82101.js"><link rel="prefetch" href="/assets/js/37.3c0c66fb.js"><link rel="prefetch" href="/assets/js/38.713057b1.js"><link rel="prefetch" href="/assets/js/39.408001f6.js"><link rel="prefetch" href="/assets/js/4.b8388267.js"><link rel="prefetch" href="/assets/js/40.787c9521.js"><link rel="prefetch" href="/assets/js/41.cc9948cd.js"><link rel="prefetch" href="/assets/js/5.d74693cd.js"><link rel="prefetch" href="/assets/js/6.225ea3d1.js"><link rel="prefetch" href="/assets/js/8.ee478468.js"><link rel="prefetch" href="/assets/js/9.bd7893d8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ffa6cac2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/kubepia.png" alt="Kubepia Documents" class="logo"> <span class="site-name can-hide">Kubepia Documents</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/devops/overview.html" class="nav-link">
  DevOps
</a></div><div class="nav-item"><a href="/k8s/" class="nav-link">
  K8S
</a></div><div class="nav-item"><a href="/ocp/overview.html" class="nav-link">
  OCP4.X
</a></div><div class="nav-item"><a href="/cloudpak/overview.html" class="nav-link">
  CloudPak
</a></div><div class="nav-item"><a href="/architecture/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="/aboutus/iamnogada.html" class="nav-link">
  About US
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/devops/overview.html" class="nav-link">
  DevOps
</a></div><div class="nav-item"><a href="/k8s/" class="nav-link">
  K8S
</a></div><div class="nav-item"><a href="/ocp/overview.html" class="nav-link">
  OCP4.X
</a></div><div class="nav-item"><a href="/cloudpak/overview.html" class="nav-link">
  CloudPak
</a></div><div class="nav-item"><a href="/architecture/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="/aboutus/iamnogada.html" class="nav-link">
  About US
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>CloudPak</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/cloudpak/cp4app/overview" class="sidebar-heading clickable open"><span>CP4App</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/cloudpak/cp4app/install/install" class="sidebar-heading clickable open"><span>Install</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/cloudpak/cp4app/install/infra01.html" class="sidebar-link">Infra Servers-VM 생성</a></li><li><a href="/cloudpak/cp4app/install/infra02.html" class="sidebar-link">Infra Servers-Web서버 설치</a></li><li><a href="/cloudpak/cp4app/install/infra03.html" class="sidebar-link">Infra Servers-VM Network 설정</a></li><li><a href="/cloudpak/cp4app/install/infra04.html" class="sidebar-link">Infra Servers-DNS서버 설치</a></li><li><a href="/cloudpak/cp4app/install/infra05.html" class="sidebar-link">Infra Servers-HAProxy서버 설치</a></li><li><a href="/cloudpak/cp4app/install/infra06.html" class="sidebar-link">Infra Servers-DHCP서버 설치</a></li><li><a href="/cloudpak/cp4app/install/infra07.html" class="sidebar-link">Infra Servers-NFS서버 설치</a></li><li><a href="/cloudpak/cp4app/install/infra08.html" class="sidebar-link">Infra Servers-SSH Key 구성</a></li><li><a href="/cloudpak/cp4app/install/infra09.html" class="sidebar-link">Infra Servers-iptables 설치</a></li><li><a href="/cloudpak/cp4app/install/ocp01.html" class="sidebar-link">OCP-ignition파일 및 VM생성</a></li><li><a href="/cloudpak/cp4app/install/ocp02.html" class="sidebar-link">OCP-OCP설치</a></li><li><a href="/cloudpak/cp4app/install/ocp03.html" class="sidebar-link">OCP-Local Image Registry 구성</a></li><li><a href="/cloudpak/cp4app/install/ocp04.html" class="sidebar-link">OCP-NFS Dynamic provisioning</a></li><li><a href="/cloudpak/cp4app/install/ocp05.html" aria-current="page" class="active sidebar-link">OCP-IdP 추가</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp05.html#htpasswd-추가" class="sidebar-link">htpasswd 추가</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp05.html#ldap-추가" class="sidebar-link">ldap 추가</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp05.html#keycloak-추가" class="sidebar-link">keycloak 추가</a></li><li class="sidebar-sub-header"><a href="/cloudpak/cp4app/install/ocp05.html#user-idp-변경" class="sidebar-link">User IdP 변경</a></li></ul></li><li><a href="/cloudpak/cp4app/install/cp4app01.html" class="sidebar-link">CP4App-Common Service 설치</a></li><li><a href="/cloudpak/cp4app/install/cp4app02.html" class="sidebar-link">CP4App-CP4App 설치</a></li></ul></section></li></ul></section></li><li><a href="/cloudpak/cp4mm/overview.html" class="sidebar-link">CP4MM</a></li><li><a href="/cloudpak/md-sample.html" class="sidebar-link">Markdown sample</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ocp-idp-추가"><a href="#ocp-idp-추가" class="header-anchor">#</a> OCP-IdP 추가</h1> <div class="custom-block tip"><p class="custom-block-title">TASK DESCRIPTION</p> <p>계정제공자(IdP-Identity Provider)를 추가합니다<br>
본 매뉴얼에서는 htpasswd와 keycloak을 설명합니다.</p> <p></p><div class="table-of-contents"><ul><li><a href="#htpasswd-추가">htpasswd 추가</a></li><li><a href="#ldap-추가">ldap 추가</a></li><li><a href="#keycloak-추가">keycloak 추가</a><ul><li><a href="#keycloak-설치">keycloak 설치</a></li><li><a href="#key-cloak-설정-realm-client-작성">key cloak 설정: realm, client 작성</a></li><li><a href="#ocp의-idp로-keycloak-등록">OCP의 IdP로 keycloak 등록</a></li></ul></li><li><a href="#user-idp-변경">User IdP 변경</a></li></ul></div><p></p></div> <h2 id="htpasswd-추가"><a href="#htpasswd-추가" class="header-anchor">#</a> htpasswd 추가</h2> <p>htpasswd는 OCP자체적으로 계정을 추가할 수 있는 방법입니다.</p> <ul><li><strong>계정 등록 파일 생성</strong></li></ul> <div class="language- extra-class"><pre class="language-text"><code>$ yum install -y httpd-tools  
$ which htpasswd  
$ htpasswd -c -B -b &lt;파일명&gt; &lt;user_name&gt; &lt;password&gt;  
계정 추가시에는 -c옵션 주면 안됨   
예) 
[root@bastion idp]# htpasswd -c -B -b users.htpasswd hklee passw0rd \
Adding password for user hklee \
[root@bastion idp]# htpasswd -B -b users.htpasswd sihan passw0rd \
Adding password for user sihan \
[root@bastion idp]# htpasswd -B -b users.htpasswd shlee passw0rd \
Adding password for user shlee \
[root@bastion idp]# cat users.htpasswd \
hklee:$2y$05$1ZSl07frbmRvwY2Uxuz.Cu38bTh.UMR8wAD1/i5YTOuym0yhX8F4S \
sihan:$2y$05$VF9BcY4pSPTy7uParHwZt.Qaf5agVto5EduZXmuPGwFxOyqdNRPqu \
shlee:$2y$05$Lx9qrVCFnC1weCMkOkj/jOA6kOkM49CjhnQrOOVFHmyrwhHz0b2Ta \
</code></pre></div><ul><li><p><strong>IdP추가</strong></p> <ul><li>OCP webconsole로그인: 최초에는 kubeadmin으로 로그인</li> <li>Administration-&gt;Cluster-Settings클릭</li> <li>Global configuration탭 클릭하고 oAuth 클릭</li> <li>IdP추가: htpasswd 선택하고 위에서 생성한 파일 지정</li></ul></li> <li><p><strong>rolebinding</strong><br>
추가한 user에게 권한을 binding 합니다.</p> <ul><li>OCP web console &gt; user management &gt; Role bindings</li> <li>create role binding</li></ul></li></ul> <h2 id="ldap-추가"><a href="#ldap-추가" class="header-anchor">#</a> ldap 추가</h2> <p>먼저 아래 링크 참조하여 LDAP서버 설치 및 구성합니다.<br> <a href="https://kubepia.github.io/cloudpak/cp4app/install/cp4app01.html" target="_blank" rel="noopener noreferrer">LDAP서버 설치 및 구성<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>그리고 OCP Web console에서 IdP를 LDAP 타입으로 추가합니다.</p> <ul><li>Administration-&gt;Cluster-Settings클릭</li> <li>Global configuration탭 클릭하고 oAuth 클릭</li> <li>IdP추가: LDAP 선택</li></ul> <p>아래 화면을 참조하여 값을 지정합니다. 특히 url, attributes &gt; id을 정확하게 지정하십시오.<br>
url이 맞는지 확인하려면 'curl [url]'명령을 이용하십시오.<br> <img src="/assets/img/2020-07-03-08-37-15.f074a2b3.png" alt=""></p> <p>등록 후 YAML에서 'insecure'를 'true'로 변경하십시오.</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  annotations:
    release.openshift.io/create-only: 'true'
  creationTimestamp: '2020-07-02T04:17:40Z'
  generation: 26
  name: cluster
  resourceVersion: '129232'
  selfLink: /apis/config.openshift.io/v1/oauths/cluster
  uid: 2c5c1e08-a2b8-4684-9282-83fb5f9fa528
spec:
  identityProviders:
    - htpasswd:
        fileData:
          name: htpasswd-cw55j
      mappingMethod: claim
      name: ADMINS
      type: HTPasswd
    - ldap:
        attributes:
          email: []
          id:
            - uid
          name:
            - cn
          preferredUsername:
            - uid
        bindDN: 'cn=admin,dc=ldap,dc=kubepia,dc=com'
        bindPassword:
          name: ldap-bind-password-b5j5j
        insecure: true
        url: 'ldap://ldap.kubepia.com:389/ou=users,dc=ldap,dc=kubepia,dc=com?uid'
      mappingMethod: claim
      name: ldap
      type: LDAP
</code></pre></div><p>저장 후 namespace 'openshift-authentication'의 Pod 2개가 재생성될때까지 기다립니다.</p> <div class="language- extra-class"><pre class="language-text"><code>[root@ocp-infra1 ~]# oc get po -n openshift-authentication
NAME                               READY   STATUS    RESTARTS   AGE
oauth-openshift-5cff94bdcd-5kqcx   1/1     Running   0          14h
oauth-openshift-5cff94bdcd-gcvlr   1/1     Running   0          14h
</code></pre></div><p>user에 권한 부여를 위해 role binding을 합니다.</p> <ul><li>OCP web console &gt; user management &gt; Role bindings</li> <li>create role binding<br>
아래는 cluster-admin 권한을 부여하는 role binding 예제입니다.<br> <img src="/assets/img/2020-07-03-08-55-51.ad855d53.png" alt=""></li></ul> <p>로그아웃 후 LDAP으로 로그인하는 버튼이 나올때까지 기다립니다.<br>
추가한 user로 로그인 테스트합니다.<br> <img src="/assets/img/2020-07-03-08-42-19.93720667.png" alt=""></p> <h2 id="keycloak-추가"><a href="#keycloak-추가" class="header-anchor">#</a> keycloak 추가</h2> <h3 id="keycloak-설치"><a href="#keycloak-설치" class="header-anchor">#</a> keycloak 설치</h3> <ul><li><strong>작업디렉토리 생성</strong><br>
cluster접근할 수 있는 Terminal에서 작업(예: bastion VM에서 작업)</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token function">mkdir</span> -p ~/tmp/keycloak
$ <span class="token builtin class-name">cd</span> ~/tmp/keycloak 
</code></pre></div><ul><li><strong>namespace 생성</strong></li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>$ oc new-project keycloak
$ oc adm policy add-scc-to-user anyuid -z default 
$ oc project keycloak
</code></pre></div><ul><li><strong>helm repository 추가</strong></li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>$ helm repo <span class="token function">add</span> codecentric https://codecentric.github.io/helm-charts
$ helm search repo keycloak
<span class="token punctuation">[</span>root@bastion ~<span class="token punctuation">]</span><span class="token comment"># helm search repo keycloak</span>
NAME                	CHART VERSION	APP VERSION	DESCRIPTION
codecentric/keycloak	<span class="token number">8.2</span>.2        	<span class="token number">10.0</span>.0     	Open Source Identity and Access Management For <span class="token punctuation">..</span>.
stable/keycloak     	<span class="token number">4.10</span>.1       	<span class="token number">5.0</span>.0      	DEPRECATED - Open Source Identity and Access Ma
</code></pre></div><ul><li><strong>helm으로 keycloak설치</strong></li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>$ helm inspect values codecentric/keycloak <span class="token operator">&gt;</span> config.yaml
$ <span class="token function">vi</span> config.yaml
<span class="token punctuation">..</span>.
  <span class="token comment">## Username for the initial Keycloak admin user</span>
  username: keycloak

  <span class="token comment">## Password for the initial Keycloak admin user. Applicable only if existingSecret is not set.</span>
  <span class="token comment">## If not set, a random 10 characters password will be used</span>
  password: <span class="token string">&quot;passw0rd&quot;</span>
<span class="token punctuation">..</span>.
  <span class="token comment">## OpenShift route configuration.</span>
  <span class="token comment">## ref: https://docs.openshift.com/container-platform/3.11/architecture/networking/routes.html</span>
  route:
    enabled: <span class="token boolean">true</span>
    path: /
<span class="token punctuation">..</span>.
  <span class="token comment">## Persistence configuration</span>
  persistence:
    <span class="token comment"># If true, the Postgres chart is deployed</span>
    deployPostgres: <span class="token boolean">true</span>

    <span class="token comment"># The database vendor. Can be either &quot;postgres&quot;, &quot;mysql&quot;, &quot;mariadb&quot;, or &quot;h2&quot;</span>
    dbVendor: postgres
<span class="token punctuation">..</span>.
postgresql:
  <span class="token comment">### PostgreSQL User to create.</span>
  <span class="token comment">##</span>
  postgresqlUsername: keycloak

  <span class="token comment">## PostgreSQL Password for the new user.</span>
  <span class="token comment">## If not set, a random 10 characters password will be used.</span>
  <span class="token comment">##</span>
  postgresqlPassword: <span class="token string">&quot;passw0rd&quot;</span>
  <span class="token punctuation">..</span>.
  <span class="token comment">## Persistent Volume Storage configuration.</span>
  <span class="token comment">## ref: https://kubernetes.io/docs/user-guide/persistent-volumes</span>
  <span class="token comment">##</span>
  persistence:
    <span class="token comment">## Enable PostgreSQL persistence using Persistent Volume Claims.</span>
    <span class="token comment">##</span>
    enabled: <span class="token boolean">true</span>

$ helm <span class="token function">install</span> keycloak -f config.yaml codecentric/keycloak -n keycloak
$ <span class="token function">watch</span> oc get po
Every <span class="token number">2</span>.0s: oc get po                                                                                                                                Sun May <span class="token number">31</span> <span class="token number">14</span>:17:18 <span class="token number">2020</span>

NAME                    READY   STATUS              RESTARTS   AGE
keycloak-0              <span class="token number">0</span>/1     Init:0/1            <span class="token number">0</span>          12s
keycloak-postgresql-0   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          12s

</code></pre></div><ul><li><strong>keycloak 로그인</strong></li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>$ oc get route 

</code></pre></div><p>웹브라우저에서 위 주소로 접근합니다.<br>
config.yaml에서 지정한 id와 pw로 로그인합니다.</p> <p><img src="/assets/img/2020-05-31-14-22-26.0c5f5ee6.png" alt=""></p> <p><img src="/assets/img/2020-05-31-14-22-41.da27fbcd.png" alt=""></p> <h3 id="key-cloak-설정-realm-client-작성"><a href="#key-cloak-설정-realm-client-작성" class="header-anchor">#</a> <strong>key cloak 설정: realm, client 작성</strong></h3> <ul><li><strong>realm 작성</strong><br>
realm은 인증대상범위를 의미합니다.</li></ul> <p><img src="/assets/img/2020-05-31-14-24-59.63cd280d.png" alt=""> <img src="/assets/img/2020-05-31-14-29-38.4ab02910.png" alt=""></p> <p>issuer주소를 clipboard에 복사해 놓습니다.<br> <img src="/assets/img/2020-05-31-14-33-29.8231fa73.png" alt=""> <img src="/assets/img/2020-05-31-14-36-32.ef13b717.png" alt=""></p> <div class="language- extra-class"><pre class="language-text"><code>예) https://keycloak-keycloak.apps.cp.kubepia.com/auth/realms/kubepia
</code></pre></div><p>public key값을 Local PC에 파일로 생성합니다.
<img src="/assets/img/2020-05-31-14-52-25.2027d6ba.png" alt=""></p> <div class="language- extra-class"><pre class="language-text"><code>public key Sample

MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnXVty1Q9jiObqJYPPAGLMiPhm8a+nVncMWoL9KVO4pZPkA6PQsYcMzq+YQyHQy442p+l8d2si5ZcNgLnnfH7WtiysMxRVUHKeNtGAetSwZIb2r/WLapiEoBoXSBZ4hREWaYfZqJAzrxgpRGsl8J5MmYj0HLoXQdY6H3CuPN+770EAA411Xvr31Z9MloC4/XKO+ZxqXUk5N8cCSWvPt1hyWpG32/fqgglcKUCdbJ1P4ieYT9y8NkBzHG9+CfGJUr7Sh7goSTKiO0gAoP/b32lmTGWnmV91JcYOmGQXbkBBA8kfB0l6C+TG574sIwmChemhNeMjU6SKCvM56RqvNR7rQIDAQAB
</code></pre></div><ul><li><strong>Client 작성</strong></li></ul> <p>Client는 keycloak으로 인증을 요청하는 소스 어플리케이션입니다.</p> <p><img src="/assets/img/2020-05-31-14-39-16.0121b6b0.png" alt=""> <img src="/assets/img/2020-05-31-15-47-13.c3671809.png" alt=""></p> <p>Credential값을 clipboard에 복사합니다.<br> <img src="/assets/img/2020-05-31-15-47-59.9f751959.png" alt=""></p> <h3 id="ocp의-idp로-keycloak-등록"><a href="#ocp의-idp로-keycloak-등록" class="header-anchor">#</a> OCP의 IdP로 keycloak 등록</h3> <p>등록방법 찾는중입니다.</p> <h2 id="user-idp-변경"><a href="#user-idp-변경" class="header-anchor">#</a> User IdP 변경</h2> <p>User의 IdP가 변경(예: htpasswd -&gt; LDAP)된 경우 처리에 대해 설명합니다.<br>
IdP가 변경된 경우 User를 삭제하고, 로그인 하려고 하면 'Cannot crete user'라는 에러가 발생합니다.<br>
아래와 같이 기존 User의 identities정보와 리소스를 삭제하고, 다시 로그인하면 됩니다.</p> <ul><li><strong>User identities정보 삭제</strong></li></ul> <div class="language- extra-class"><pre class="language-text"><code>$ oc get User
$ oc edit User hklee
</code></pre></div><table><thead><tr><th style="text-align:left;">As-Is</th> <th style="text-align:left;">To-Be</th></tr></thead> <tbody><tr><td style="text-align:left;"><img src="/assets/img/2020-07-07-22-52-33.5a6e6613.png" alt=""></td> <td style="text-align:left;"><img src="/assets/img/2020-07-07-22-55-55.7a81be54.png" alt=""></td></tr></tbody></table> <ul><li><strong>identities 리소스 삭제</strong></li></ul> <div class="language- extra-class"><pre class="language-text"><code>$ oc get identities
$ oc delete identities admin:hklee
</code></pre></div><ul><li><strong>재 로그인</strong><br>
새로운 IdP로 다시 로그인하고 User정보를 보면 새로운 Identity정보로 변경된것을 확인할 수 있습니다.</li></ul> <div class="language- extra-class"><pre class="language-text"><code>$ oc get User
$ oc get identities
</code></pre></div><hr> <div id="disqus_thread"></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/cloudpak/cp4app/install/ocp04.html" class="prev">
        OCP-NFS Dynamic provisioning
      </a></span> <span class="next"><a href="/cloudpak/cp4app/install/cp4app01.html">
        CP4App-Common Service 설치
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.faac2083.js" defer></script><script src="/assets/js/3.8d0845ad.js" defer></script><script src="/assets/js/7.85e72874.js" defer></script><script src="/assets/js/28.82f53b83.js" defer></script>
  </body>
</html>
