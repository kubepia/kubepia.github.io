(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{342:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-02-38-00.defb37ee.png"},343:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-20-18-04.9650c813.png"},344:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-20-18-38.b4cf6c46.png"},345:function(t,e,a){t.exports=a.p+"assets/img/2020-05-28-16-50-56.f58f2c56.png"},346:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-20-38-45.f6a4199c.png"},347:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-20-53-49.8cba5f83.png"},348:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-20-56-29.601b6555.png"},349:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-21-05-20.f6d301fa.png"},350:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-21-06-39.1bf9d754.png"},351:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-21-08-19.7b27ea69.png"},352:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-21-20-31.7621d6a5.png"},353:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-21-28-11.40838593.png"},354:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-22-38-31.3e253d1c.png"},355:function(t,e,a){t.exports=a.p+"assets/img/2020-05-28-17-17-10.6556392e.png"},356:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-22-49-12.452cb92a.png"},357:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-22-50-42.37a73a4a.png"},358:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-22-53-22.cd899c69.png"},359:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-22-54-08.c41e9727.png"},360:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-22-55-37.79b5164a.png"},361:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-22-57-31.84bb112f.png"},362:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-22-58-28.4bc2d7e4.png"},363:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-22-59-12.3c4b7b3f.png"},364:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-23-00-36.51bd69a0.png"},365:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-23-02-59.a763f695.png"},366:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-23-12-11.c266d58b.png"},367:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-23-15-29.2dc8882b.png"},368:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-23-28-01.ab22015d.png"},369:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-23-30-50.2e23526c.png"},370:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-23-31-34.c37b762e.png"},371:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-23-33-25.a8618b1c.png"},372:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-23-39-27.f4220b88.png"},373:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-23-43-15.4f07c362.png"},374:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-23-51-53.737b9429.png"},375:function(t,e,a){t.exports=a.p+"assets/img/2020-05-28-18-29-52.864b576b.png"},376:function(t,e,a){t.exports=a.p+"assets/img/2020-05-25-23-52-59.576e31cb.png"},377:function(t,e,a){t.exports=a.p+"assets/img/2020-05-28-17-35-54.02809999.png"},378:function(t,e,a){t.exports=a.p+"assets/img/2020-05-26-00-04-28.d0901863.png"},444:function(t,e,a){"use strict";a.r(e);var s=a(17),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"ocp-ignition파일-및-vm생성"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ocp-ignition파일-및-vm생성"}},[t._v("#")]),t._v(" OCP-ignition파일 및 VM생성")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TASK DESCRIPTION")]),t._v(" "),s("p",[t._v("ignition파일은 RHCOS(RedHat Core OS)가 실행될때 참조하는 제반설정정보입니다."),s("br"),t._v("\nopenshift-install명령을 이용하여 ignition 파일을 생성합니다."),s("br"),t._v("\n생성된 파일의 내용을 base64로 암호화하여 VM Node의 속성으로 등록합니다."),s("br"),t._v("\n버전별 설치가이드를 참고하십시오.")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://docs.openshift.com/container-platform/4.3/installing/installing_vsphere/installing-vsphere.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("OCP4.3 install 가이드"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.openshift.com/container-platform/4.4/installing/installing_vsphere/installing-vsphere.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("OCP4.4 install 가이드"),s("OutboundLink")],1),s("br"),t._v("\n본 설치매뉴얼은 vmware vSphere상의 설치를 위해 작성되었습니다.")])]),t._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#사전준비"}},[t._v("사전준비")])]),s("li",[s("a",{attrs:{href:"#설치-프로그램-다운로드"}},[t._v("설치 프로그램 다운로드")])]),s("li",[s("a",{attrs:{href:"#설치-작업-디렉토리-생성"}},[t._v("설치 작업 디렉토리 생성")])]),s("li",[s("a",{attrs:{href:"#install-config-yaml-생성"}},[t._v("install-config.yaml 생성")])]),s("li",[s("a",{attrs:{href:"#install-manifest파일-생성-및-수정"}},[t._v("install manifest파일 생성 및 수정")])]),s("li",[s("a",{attrs:{href:"#ignition-파일-생성"}},[t._v("ignition 파일 생성")])]),s("li",[s("a",{attrs:{href:"#append-bootstrap-ign파일-생성"}},[t._v("append-bootstrap.ign파일 생성")])]),s("li",[s("a",{attrs:{href:"#ignition파일-base64-encoding"}},[t._v("ignition파일 base64 encoding")])]),s("li",[s("a",{attrs:{href:"#vm-template-작성"}},[t._v("VM Template 작성")])]),s("li",[s("a",{attrs:{href:"#master-node-vm-생성"}},[t._v("Master Node VM 생성")])]),s("li",[s("a",{attrs:{href:"#worker-node-vm-생성"}},[t._v("Worker Node VM 생성")])]),s("li",[s("a",{attrs:{href:"#bootstrap-node-vm-생성"}},[t._v("Bootstrap Node VM 생성")])]),s("li",[s("a",{attrs:{href:"#snapshot-만들기"}},[t._v("Snapshot 만들기")])])])]),s("p")]),t._v(" "),s("h2",{attrs:{id:"사전준비"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#사전준비"}},[t._v("#")]),t._v(" 사전준비")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("vSphere버전")]),s("br"),t._v("\nvSphere 6.5상에도 설치가능하지만 vSphere Version 6.7 U2이상을 권장합니다.")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("System requirements")]),t._v("\n문서상의 최소 사양은 아래와 같습니다."),s("br"),t._v(" "),s("img",{attrs:{src:a(342),alt:""}})])])]),t._v(" "),s("p",[t._v("경험상 CP4App까지 설치하여 운영하기 위한 사양은 아래와 같습니다.")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("Machine")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("vCPU")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("vRAM")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("Storage")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("Bootstrap")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("8")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("16")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("120")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("Control plane")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("8")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("32")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("120")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("Compute")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("16")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("32")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("120")])])])]),t._v(" "),s("p",[t._v("Master Node는 최소 3개이상, Worker Node는 최소 2개 이상 필요합니다.")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("User Provisioned Infra 환경 준비")]),s("br"),t._v("\n아래와 같은 인프라 환경구성이 필요합니다.\n"),s("ul",[s("li",[t._v("Network connections")]),t._v(" "),s("li",[t._v("DNS")]),t._v(" "),s("li",[t._v("L/B")]),t._v(" "),s("li",[t._v("DHCP")]),t._v(" "),s("li",[t._v("Configure Ports\n참조: "),s("a",{attrs:{href:"https://docs.openshift.com/container-platform/4.3/installing/installing_vsphere/installing-vsphere.html#installation-network-user-infra_installing-vsphere",target:"_blank",rel:"noopener noreferrer"}},[t._v("User provisioned infrastructure"),s("OutboundLink")],1)])])])]),t._v(" "),s("h2",{attrs:{id:"설치-프로그램-다운로드"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#설치-프로그램-다운로드"}},[t._v("#")]),t._v(" 설치 프로그램 다운로드")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("Local PC에서 파일 다운로드")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("**"),s("a",{attrs:{href:"https://cloud.redhat.com/openshift/install",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redhat 설치 가이드"),s("OutboundLink")],1),t._v("**으로 로그인합니다."),s("br"),t._v("\n그리고 설치 인프라 환경을 선택하십시오.  본 매뉴얼에서는 vmware상에 설치합니다."),s("br"),t._v(" "),s("img",{attrs:{src:a(343),alt:""}})])]),t._v(" "),s("li",[s("p",[t._v("OS에 맞는 설치 openshift-install, Pull secret값, RHCOS, OC CLI를 다운로드 합니다.\n"),s("img",{attrs:{src:a(344),alt:""}})])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("bastion VM으로 복사")]),s("br"),t._v("\nLocal PC의 다운로드 위치는 '~/Downloads/ocp'이고, basion VM의 target 디렉토리는 '~/tmp'일때"),s("br"),t._v("\n아래와 같이 작업하면 됩니다."),s("br"),t._v("\n이전 "),s("a",{attrs:{href:"https://kubepia.github.io/cloudpak/cp4app/install/infra08.html#ssl-key-%EC%83%9D%EC%84%B1",target:"_blank",rel:"noopener noreferrer"}},[t._v("sslkey 구성"),s("OutboundLink")],1),t._v("단계에서 Local PC에 대한 작업을 미리 해야 암호없이 파일을 복사할 수 있습니다.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("$ cd ~/Downloads/ocp   \n$ scp -P 19022 ./openshift-client-linux.tar.gz kubepia:~/tmp\n$ scp -P 19022 ./openshift-install-linux.tar.gz kubepia:~/tmp\n$ scp -P 19022 ./pull-secret.txt kubepia:~/tmp \n")])])]),s("ul",[s("li",[s("strong",[t._v("bastion VM에서 압축해제 및 CLI파일 복사")])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("$ cd ~/tmp\n$ tar xvf openshift-client-linux.tar.gz\n$ tar xvf openshift-install-linux.tar.gz\n$ cp oc /usr/local/bin && cp kubectl /usr/local/bin && cp openshift-install /usr/local/bin\n")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("openshift-install, OC가 잘 설치되었는지 확인합니다.")]),s("br"),t._v(" "),s("img",{attrs:{src:a(345),alt:""}})])])]),t._v(" "),s("h2",{attrs:{id:"설치-작업-디렉토리-생성"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#설치-작업-디렉토리-생성"}},[t._v("#")]),t._v(" 설치 작업 디렉토리 생성")]),t._v(" "),s("p",[t._v("install-config.yaml과 ignition파일들이 생성될 설치 작업 디렉토리를 생성합니다.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("$ mkdir -p /install/config\n")])])]),s("h2",{attrs:{id:"install-config-yaml-생성"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#install-config-yaml-생성"}},[t._v("#")]),t._v(" install-config.yaml 생성")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://docs.openshift.com/container-platform/4.3/installing/installing_vsphere/installing-vsphere.html#installation-vsphere-config-yaml_installing-vsphere",target:"_blank",rel:"noopener noreferrer"}},[t._v("Sample install-config.yaml"),s("OutboundLink")],1),t._v("파일을 참조하여 작성합니다.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Sample\n\napiVersion: v1\nbaseDomain: darumtech.net \ncompute:\n- hyperthreading: Enabled   \n  name: worker\n  replicas: 2 \ncontrolPlane:\n  hyperthreading: Enabled   \n  name: master\n  replicas: 3 \nmetadata:\n  name: cp \nplatform:\n  vsphere:\n    vcenter: your.vcenter.server \n    username: username \n    password: password \n    datacenter: datacenter \n    defaultDatastore: datastore \nfips: false \npullSecret: '{\"auths\": ...}' \nsshKey: 'ssh-ed25519 AAAA...' \n")])])]),s("p",[t._v("각 항목 설정방법은 아래와 같습니다.")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("항목")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("설명")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("예")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("baseDomain")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("기본 도메인")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("kubepia.com")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("compute.replicas")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("worker node 수")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("2")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("controlPlane.replicas")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("master node 수(3이상의 홀수)")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("3")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("metadata.name")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("클러스터 이름. [name].[baseDomain]으로 기본 주소 사용됨")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("cp")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("platform.vsphere.vcenter")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("vSphere vCenter hostname 또는 IP")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("192.168.0.70")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("platform.vsphere.username")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("vSphere의 username")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("administrator@vsphere.local")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("platform.vsphere.password")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("vSphere의 password")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("passw0rd$")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("platform.vsphere.datacenter")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("vSphere Datacenter명")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("NX-DC")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("platform.vsphere.defaultDatastore")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("vSphere의 기본 Datastore")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("VMware-NFS")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("fips")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Disk 암호화 사용 여부")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("false")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("pullSecret")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("site별 SSL token값. 위 설치프로그램 다운로드 시 저장한 pullSecret파일 내용을 붙여넣게 합니다.")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("생략")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("sshKey")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://kubepia.github.io/cloudpak/cp4app/install/infra08.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("SSHKey 구성"),s("OutboundLink")],1),t._v("시 생성한 public key파일 내용")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("생략")])])])]),t._v(" "),s("blockquote",[s("p",[t._v("defaultDatastore확인 "),s("br"),t._v(" "),s("img",{attrs:{src:a(346),alt:""}})])]),t._v(" "),s("p",[s("img",{attrs:{src:a(347),alt:""}})]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("반드시 install-config.yaml 백업")]),t._v(" "),s("p",[t._v("install-config.yaml파일은 OCP 설치를 시작하면 없어집니다."),s("br"),t._v("\n반드시 백업파일을 생성하시기 바랍니다.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("$ cp install-config.yaml install-config-org.yaml\n")])])]),s("p",[s("img",{attrs:{src:a(348),alt:""}})])]),t._v(" "),s("h2",{attrs:{id:"install-manifest파일-생성-및-수정"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#install-manifest파일-생성-및-수정"}},[t._v("#")]),t._v(" install manifest파일 생성 및 수정")]),t._v(" "),s("p",[t._v("설치 관련 설정 내용을 담고 있는 manifest파일들을 생성합니다."),s("br"),t._v("\n이 단계는 특별히 수정할게 없으면 생략해도 됩니다."),s("br"),t._v("\n'installation_directory'는 install-config.yaml파일이 있는 디렉토리입니다.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("$ openshift-install create manifests --dir=<installation_directory>\n")])])]),s("p",[s("img",{attrs:{src:a(349),alt:""}})]),t._v(" "),s("p",[t._v("manifest파일들은 <installation_directory>/manifests디렉토리에 생성됩니다."),s("br"),t._v(" "),s("img",{attrs:{src:a(350),alt:""}})]),t._v(" "),s("p",[t._v("'cluster-scheduler-02-config.yml'파일에서 'mastersSchedulable'의 값을 'false'로 변경합니다."),s("br"),t._v("\nMaster node에 Pod가 배포되지 않도록 하기 위함입니다."),s("br"),t._v(" "),s("img",{attrs:{src:a(351),alt:""}})]),t._v(" "),s("h2",{attrs:{id:"ignition-파일-생성"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ignition-파일-생성"}},[t._v("#")]),t._v(" ignition 파일 생성")]),t._v(" "),s("p",[t._v("RHCOS 부팅 시 참조하는 ignition파일들을 생성합니다.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("$ openshift-install create ignition-configs --dir=<installation_directory> \n\n아래와 같은 구조로 파일들이 생성됩니다.  \nauth/kubeadmin-password는 kubeadmin사용자의 암호이고,  \nauth/kubeconfig는 cluster로그인 설정정보입니다.  \nkubeconfig파일은 사용할 Terminal의 <HOME>/.kube/config파일로 복사하면  \ncluster에 인증되어 접근할 수 있습니다.   \n.\n├── auth\n│   ├── kubeadmin-password\n│   └── kubeconfig\n├── bootstrap.ign\n├── master.ign\n├── metadata.json\n└── worker.ign\n")])])]),s("h2",{attrs:{id:"append-bootstrap-ign파일-생성"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#append-bootstrap-ign파일-생성"}},[t._v("#")]),t._v(" append-bootstrap.ign파일 생성")]),t._v(" "),s("p",[t._v("각 Node용 VM을 생성할 때 ignition파일의 내용을 base64 encoding하여 셋팅하여야 합니다."),s("br"),t._v("\n그런데 bootstrap.ign의 내용이 너무 많아 길이 제한에 걸려"),s("br"),t._v("\nbase64 encoding한 값을 셋팅할 수 없습니다."),s("br"),t._v("\n그래서 bootstrap.ign파일을 Web서버에 업로드하고,"),s("br"),t._v("\n그 주소를 지정한 append-bootstrap.ign파일을 생성하여 셋팅합니다.")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("bootstrap.ign파일을 Web서버에 복사")]),s("br"),t._v("\nbootstrap VM에 "),s("a",{attrs:{href:"https://kubepia.github.io/cloudpak/cp4app/install/infra02.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Web서버가 설치"),s("OutboundLink")],1),t._v("되어 있습니다."),s("br"),t._v("\nhome디렉토리인 /var/www/html하위에 install디렉토리를 만들고 bootstrap.ign파일을 복사합니다.")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("예시)\n\n[root@bastion config]# mkdir -p /var/www/html/install\n[root@bastion config]# cp bootstrap.ign /var/www/html/install\n[root@bastion config]# ls -al /var/www/html/install\ntotal 304\ndrwxr-xr-x. 2 root root     27 May 28 17:03 .\ndrwxr-xr-x. 3 root root     38 May 28 17:03 ..\n-rw-r-----. 1 root root 308269 May 28 17:03 bootstrap.ign\n\nCOPY후 mode를 변경하고 curl로 접근을 확인합니다.  \n[root@bastion config]# chmod 777 /var/www/html/install/*\n[root@bastion config]# curl http://172.168.0.190/install/bootstrap.ign\n\n")])])]),s("ul",[s("li",[s("strong",[t._v("append-bootstrap.ign 생성")])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('{\n  "ignition": {\n    "config": {\n      "append": [\n        {\n          "source": "<bootstrap_ignition_config_url>", \n          "verification": {}\n        }\n      ]\n    },\n    "timeouts": {},\n    "version": "2.1.0"\n  },\n  "networkd": {},\n  "passwd": {},\n  "storage": {},\n  "systemd": {}\n}\n')])])]),s("p",[s("img",{attrs:{src:a(352),alt:""}})]),t._v(" "),s("h2",{attrs:{id:"ignition파일-base64-encoding"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ignition파일-base64-encoding"}},[t._v("#")]),t._v(" ignition파일 base64 encoding")]),t._v(" "),s("p",[t._v("base64 encoding한 ignition파일들을 생성합니다.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("$ base64 -w0 <installation_directory>/master.ign > <installation_directory>/master.64\n$ base64 -w0 <installation_directory>/worker.ign > <installation_directory>/worker.64\n$ base64 -w0 <installation_directory>/append-bootstrap.ign > <installation_directory>/append-bootstrap.64\n\n예시)\n$ base64 -w0 /install/config/master.ign > /install/config/master.64\n$ base64 -w0 /install/config/worker.ign > /install/config/worker.64\n$ base64 -w0 /install/config/append-bootstrap.ign > /install/config/append-bootstrap.64\n\n")])])]),s("p",[s("img",{attrs:{src:a(353),alt:""}})]),t._v(" "),s("h2",{attrs:{id:"vm-template-작성"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vm-template-작성"}},[t._v("#")]),t._v(" VM Template 작성")]),t._v(" "),s("p",[t._v("각 Node VM을 만들 VM Template을 생성합니다.")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("RHCOS image인 ova파일을 다운로드 합니다.")])]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://cloud.redhat.com/openshift/install",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redhat 설치페이지"),s("OutboundLink")],1),t._v("을 로그인")]),t._v(" "),s("li",[t._v("설치할 IaaS선택. 이 매뉴얼에서는 vmware선택")]),t._v(" "),s("li",[t._v("'Red Hat Enterprise Linux CoreOS (RHCOS)'의 [Download RHCOS] 버튼 클릭")]),t._v(" "),s("li",[t._v("'rhcos-[version]-x86_64-vmware.x86_64.ova'클릭하여 다운로드"),s("br"),t._v(" "),s("img",{attrs:{src:a(354),alt:""}})])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("작업폴더를 생성합니다.")])]),t._v(" "),s("ul",[s("li",[t._v("vSphere Client로그인")]),t._v(" "),s("li",[t._v("좌측 Tree상단의 'VMs and Templates'를 클릭하고, 아래 예시와 같이 폴더를 구성합니다."),s("br"),t._v(" "),s("img",{attrs:{src:a(355),alt:""}})])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("VM Template을 작성합니다.")])]),t._v(" "),s("ul",[s("li",[t._v("PC에 다운로드한 ova파일을 복사-붙여넣기하여 vcenter vm으로 복사")]),t._v(" "),s("li",[t._v("'templates'폴더 선택->우측마우스메뉴에서 'Deploy OVF Template'클릭"),s("br"),t._v(" "),s("img",{attrs:{src:a(356),alt:""}})]),t._v(" "),s("li",[t._v("'Local file'선택하고 ova파일 위치 지정"),s("br"),t._v(" "),s("img",{attrs:{src:a(357),alt:""}})]),t._v(" "),s("li",[t._v("template명과 folder선택"),s("br"),t._v(" "),s("img",{attrs:{src:a(358),alt:""}})]),t._v(" "),s("li",[t._v("Compute resource는 아무거나 선택"),s("br"),t._v(" "),s("img",{attrs:{src:a(359),alt:""}})]),t._v(" "),s("li",[t._v("선택내용 review"),s("br"),t._v(" "),s("img",{attrs:{src:a(360),alt:""}})]),t._v(" "),s("li",[t._v("Virtual Disk format은 'Thin Provision'선택하고 Storage선택"),s("br"),t._v(" "),s("img",{attrs:{src:a(361),alt:""}})]),t._v(" "),s("li",[t._v("Network은 'VM Network'선택"),s("br"),t._v(" "),s("img",{attrs:{src:a(362),alt:""}})]),t._v(" "),s("li",[t._v("'Customize template'은 Skip함"),s("br"),t._v(" "),s("img",{attrs:{src:a(363),alt:""}})]),t._v(" "),s("li",[t._v("'Ready to complete'에서 마지막으로 설정 내용 검토하고 [FINISH]클릭"),s("br"),t._v(" "),s("img",{attrs:{src:a(364),alt:""}})]),t._v(" "),s("li",[t._v("생성된 VM선택->우측마우스메뉴에서 'Template->Convert to template'클릭"),s("br"),t._v(" "),s("img",{attrs:{src:a(365),alt:""}})])])])]),t._v(" "),s("h2",{attrs:{id:"master-node-vm-생성"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#master-node-vm-생성"}},[t._v("#")]),t._v(" Master Node VM 생성")]),t._v(" "),s("p",[t._v("Master node VM을 생성합니다.")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("VM template 선택 -> 우측마우스메뉴에서 'New VM from This Template'클릭")]),s("br"),t._v(" "),s("img",{attrs:{src:a(366),alt:""}})]),t._v(" "),s("li",[s("strong",[t._v("VM의 이름과 folder를 지정")]),s("br"),t._v(" "),s("img",{attrs:{src:a(367),alt:""}})])]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("VM이름")]),t._v(" "),s("br"),t._v("\nVM이름의 규칙은 없지만 헷갈리지 않도록 "),s("a",{attrs:{href:"https://kubepia.github.io/cloudpak/cp4app/install/infra06.html#dhcp%EC%84%9C%EB%B2%84-%EC%84%A4%EC%B9%98",target:"_blank",rel:"noopener noreferrer"}},[t._v("dhcpd.conf파일에 지정"),s("OutboundLink")],1),t._v("한 이름을 참조하여 작명하십시오.")])]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("'Compute resource'는 아무거나 지정하면 됨")]),s("br"),t._v(" "),s("a",{attrs:{href:"https://kubepia.github.io/cloudpak/cp4app/install/infra01.html#drs%EC%9E%90%EB%8F%99%ED%99%94-%EC%84%A4%EC%A0%95",target:"_blank",rel:"noopener noreferrer"}},[t._v("DRS-Distributed Resources Scheduler"),s("OutboundLink")],1),t._v("를 이용하므로 자동으로 IP가 부여됨"),s("br"),t._v(" "),s("img",{attrs:{src:a(368),alt:""}})])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("Storage선택")]),s("br"),t._v(" "),s("img",{attrs:{src:a(369),alt:""}})])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("'Customize this virtual machine's hardware'체크")]),s("br"),t._v(" "),s("img",{attrs:{src:a(370),alt:""}})])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("CPU/MEM/Disk 지정")]),s("br"),t._v(" "),s("a",{attrs:{href:"https://kubepia.github.io/cloudpak/cp4app/install/ocp01.html#%EC%82%AC%EC%A0%84%EC%A4%80%EB%B9%84",target:"_blank",rel:"noopener noreferrer"}},[t._v("System requirements"),s("OutboundLink")],1),t._v("를 참조하여 지정하세요."),s("br"),t._v("\n메모리 항목을 펼치고 'Reservation'을 동일하게 바꿔 주십시오."),s("br"),t._v(" "),s("img",{attrs:{src:a(371),alt:""}})])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("Network MAC Address지정")]),s("br"),t._v("\nNetwork Adapter1을 펼치고 MAC Address항목의 'Automatic'을 'Manual'로 변경하십시오."),s("br"),t._v("\nMAC Address는 Network VM의 /etc/dhcpd.conf에 정의한 MAC주소를 입력하십시오."),s("br"),t._v(" "),s("a",{attrs:{href:"https://kubepia.github.io/cloudpak/cp4app/install/infra06.html#dhcp%EC%84%9C%EB%B2%84-%EC%84%A4%EC%B9%98",target:"_blank",rel:"noopener noreferrer"}},[t._v("dhcpd.conf파일 설정"),s("OutboundLink")],1),t._v("을 참고 하십시오."),s("br"),t._v(" "),s("img",{attrs:{src:a(372),alt:""}})])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("ignition내용 셋팅")]),s("br"),t._v("\nRHCOS부팅시에 참조할 ignition값을 파라미터로 셋팅합니다.")]),t._v(" "),s("ul",[s("li",[t._v("'VM Options'탭을 클릭하고 'Configuration Parameters'의 [EDIT CONFIGURATION]을 클릭하십시오."),s("br"),t._v(" "),s("img",{attrs:{src:a(373),alt:""}})]),t._v(" "),s("li",[t._v("[Add Configuration Params]버튼을 클릭하여 파라미터를 추가")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("파라미터")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("값")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("guestinfo.ignition.config.data")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("master.64파일 내용")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("guestinfo.ignition.config.data.encoding")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("base64")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("disk.EnableUUID")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("TRUE")])])])]),t._v(" "),s("p",[s("img",{attrs:{src:a(374),alt:""}})])])]),t._v(" "),s("blockquote",[s("p",[t._v("** 주의 **"),s("br"),t._v("\nbase64 내용을 'cat'명령어로 볼 때 아래와 같이 ';echo'를 붙이십시오.")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("$ cat append-bootstrap.64;echo\n")])])]),s("p",[s("img",{attrs:{src:a(375),alt:""}})]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("설정내용 최종검토")]),s("br"),t._v("\n최종 검토 후 [FINISH]버튼을 클릭합니다."),s("br"),t._v(" "),s("img",{attrs:{src:a(376),alt:""}})])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("모든 Master node VM 생성")]),t._v(" "),s("p",[t._v("VM이름과 MAC Address만 다르게 하여 나머지 Master Node VM들을 생성합니다.\n아래와 같이 첫번째 만든 기존 VM을 복사하여 MAC Address만 변경하면 됩니다.\n"),s("img",{attrs:{src:a(377),alt:""}})])]),t._v(" "),s("h2",{attrs:{id:"worker-node-vm-생성"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#worker-node-vm-생성"}},[t._v("#")]),t._v(" Worker Node VM 생성")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Worker node VM 생성")]),t._v(" "),s("p",[t._v("Master node VM생성단계를 참고하여 모든 Worker node VM들을 생성합니다."),s("br"),t._v("\n단, 아래 단계에서는 Worker node에 맞게 변경하여야 합니다.")]),t._v(" "),s("ul",[s("li",[t._v("VM의 이름과 folder를 지정")]),t._v(" "),s("li",[t._v("CPU/MEM/Disk 지정")]),t._v(" "),s("li",[t._v("Network MAC Address지정")]),t._v(" "),s("li",[t._v("ignition내용 셋팅: worker.64파일 내용으로 셋팅")])])]),t._v(" "),s("h2",{attrs:{id:"bootstrap-node-vm-생성"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bootstrap-node-vm-생성"}},[t._v("#")]),t._v(" Bootstrap Node VM 생성")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Bootstrap node VM 생성")]),t._v(" "),s("p",[t._v("Master node VM생성단계를 참고하여 Bootstrap node VM들을 생성합니다."),s("br"),t._v("\n단, 아래 단계에서는 Bootstrap node에 맞게 변경하여야 합니다.")]),t._v(" "),s("ul",[s("li",[t._v("VM의 이름과 folder를 지정")]),t._v(" "),s("li",[t._v("CPU/MEM/Disk 지정")]),t._v(" "),s("li",[t._v("Network MAC Address지정")]),t._v(" "),s("li",[t._v("ignition내용 셋팅: append-bootstrap.64파일 내용으로 셋팅")])])]),t._v(" "),s("h2",{attrs:{id:"snapshot-만들기"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#snapshot-만들기"}},[t._v("#")]),t._v(" Snapshot 만들기")]),t._v(" "),s("p",[t._v("지금까지 작업한 내용을 백업하기 위해 각 VM의 Snapshot을 생성합니다."),s("br"),t._v(" "),s("img",{attrs:{src:a(378),alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("※ Infra VM들은 중지하고 Snapshot을 생성하셔야 빠르게 snapshot이 만들어집니다.")])]),t._v(" "),s("hr"),t._v(" "),s("disqus")],1)}),[],!1,null,null,null);e.default=n.exports}}]);