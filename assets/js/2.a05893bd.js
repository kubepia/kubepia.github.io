(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{327:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-16-52-38.af4bb723.png"},356:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-16-58-51.c8b10d1e.png"},357:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-33-02.0a7fc9fd.png"},358:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-35-16.90442847.png"},359:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-35-46.41d49a81.png"},360:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-37-23.de5218ec.png"},361:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-38-31.446dffe3.png"},362:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-39-23.2b0c6955.png"},363:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-41-34.368ebb40.png"},364:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-42-19.af19d841.png"},365:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-46-50.7cb14922.png"},366:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-47-24.de935a94.png"},367:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-47-56.82ae6f10.png"},368:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-48-29.2e906acc.png"},369:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-49-12.6e52938f.png"},370:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-49-44.2e1536cb.png"},371:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-50-46.11e108cb.png"},372:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-51-41.d9184816.png"},373:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-52-48.64af993e.png"},374:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-57-40.0f90e384.png"},375:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-17-56-29.9d42c038.png"},376:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-18-02-39.def05f21.png"},377:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-18-04-00.dc4b8e85.png"},378:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-20-31-29.09aea278.png"},379:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-20-32-15.73f7678d.png"},380:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-20-32-52.f0b868d7.png"},381:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-20-54-57.4b79774f.png"},382:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-21-07-34.6907198f.png"},383:function(t,e,s){t.exports=s.p+"assets/img/2020-05-29-14-18-14.dab75737.png"},384:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-21-13-17.d9d95836.png"},385:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-21-18-15.58dede26.png"},386:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-21-18-44.75d0ccf0.png"},387:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-21-25-09.e9156a8b.png"},388:function(t,e,s){t.exports=s.p+"assets/img/2020-05-29-14-35-20.ae7d933c.png"},389:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-21-34-29.6acbd18a.png"},390:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-21-37-43.412c6da3.png"},391:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-21-38-49.cced4701.png"},392:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-21-39-57.22d1cc7e.png"},393:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-21-45-03.09d69133.png"},394:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-21-41-30.85e50e79.png"},395:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-21-45-58.0fda5e55.png"},396:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-21-58-38.1bd14e91.png"},397:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-22-13-04.1b1a0d70.png"},398:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-22-18-16.64b42743.png"},399:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-22-19-00.4fe686b9.png"},400:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-22-20-03.16144bc0.png"},401:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-22-23-30.593a0523.png"},402:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-22-27-18.42e7f681.png"},403:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-22-31-47.5adb2607.png"},404:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-22-33-12.5496c58a.png"},405:function(t,e,s){t.exports=s.p+"assets/img/2020-05-26-22-33-57.820ac53f.png"},406:function(t,e,s){t.exports=s.p+"assets/img/2020-05-30-15-44-44.f32d9b4f.png"},407:function(t,e,s){t.exports=s.p+"assets/img/2020-05-30-15-43-19.1f87c402.png"},597:function(t,e,s){"use strict";s.r(e);var a=s(25),r=Object(a.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"cp4app-common-service-설치"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cp4app-common-service-설치"}},[t._v("#")]),t._v(" CP4App-Common Service 설치")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TASK DESCRIPTION")]),t._v(" "),a("p",[t._v("IBM Common Service를 설치합니다."),a("br"),t._v("\nCommon Service는 IAM, Metering, Monitoring을 제공합니다."),a("br"),t._v("\nIBM Common Service설치 가이드는 아래와 같이 볼 수 있습니다.")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.ibm.com/support/knowledgecenter/en/SSCSJL/welcome.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("CP4App knowledge center"),a("OutboundLink")],1),t._v("접근")]),t._v(" "),a("li",[t._v("설치할 버전 선택")]),t._v(" "),a("li",[t._v("Installing > Installing with the cloud pak CLI > Installing Common Services 클릭"),a("br"),t._v(" "),a("img",{attrs:{src:s(327),alt:""}})])]),t._v(" "),a("p",[t._v("IBM Common Service IAM에 대한 설명, 설치, 구성에 대해서는 아래 동영상을 참조하십시오."),a("br"),t._v(" "),a("a",{attrs:{href:"https://drive.google.com/file/d/1seMcwdapR2tf9lJSkp-jsBGogG86elyw/view?usp=sharing",target:"_blank",rel:"noopener noreferrer"}},[t._v("IBM Common Service IAM"),a("OutboundLink")],1)]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#ldap서버-설치-및-user-group추가"}},[t._v("LDAP서버 설치 및 user/group추가")]),a("ul",[a("li",[a("a",{attrs:{href:"#snapshot-작성"}},[t._v("snapshot 작성")])])])]),a("li",[a("a",{attrs:{href:"#ibm-common-service-설치"}},[t._v("IBM Common Service 설치")]),a("ul",[a("li",[a("a",{attrs:{href:"#설치registry를-접근하기-위한-entitlement-key취득"}},[t._v("설치registry를 접근하기 위한 entitlement key취득")])]),a("li",[a("a",{attrs:{href:"#설치-configuration-files-생성"}},[t._v("설치 configuration files 생성")])]),a("li",[a("a",{attrs:{href:"#설치-config파일들-수정"}},[t._v("설치 config파일들 수정")])]),a("li",[a("a",{attrs:{href:"#installer-실행"}},[t._v("installer 실행")])]),a("li",[a("a",{attrs:{href:"#common-service-로그인"}},[t._v("Common Service 로그인")])])])]),a("li",[a("a",{attrs:{href:"#ibm-common-service-설정"}},[t._v("IBM Common Service 설정")])]),a("li",[a("a",{attrs:{href:"#ocp-ocp-idp로-등록"}},[t._v("OCP-OCP IdP로 등록")])]),a("li",[a("a",{attrs:{href:"#logout-버그-fix"}},[t._v("Logout 버그 Fix")])])])]),a("p")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("설치 시 "),a("a",{attrs:{href:"https://happycloud-lee.tistory.com/119",target:"_blank",rel:"noopener noreferrer"}},[t._v("screen: 가상터미널을 이용한 백그라운드 명령 실행"),a("OutboundLink")],1),t._v("을 이용하여 보십시오."),a("br"),t._v("\n실수나 네트워크 단절로 Terminal이 끊어져도 안전하게 설치를 진행할 수 있습니다.")])]),t._v(" "),a("p",[t._v("아래 작업은 Cluster api-server에 접근할 수 있는 Terminal 또는 bastion서버에서 수행합니다.")]),t._v(" "),a("h2",{attrs:{id:"ldap서버-설치-및-user-group추가"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ldap서버-설치-및-user-group추가"}},[t._v("#")]),t._v(" LDAP서버 설치 및 user/group추가")]),t._v(" "),a("p",[t._v("IBM Common Service의 IAM은 IdP(Identity Provider)로 LDAP만 지원합니다.")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("아래 글을 참조하여 LDAP서버를 docker 또는 Pod로 설치합니다.")])])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://happycloud-lee.tistory.com/117?category=832250",target:"_blank",rel:"noopener noreferrer"}},[t._v("LDAP서버 설치"),a("OutboundLink")],1),t._v(" "),a("img",{attrs:{src:s(356),alt:""}})]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("LDAP user/group추가")])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("ou=users, ou=groups추가")]),a("br"),t._v("\nGeneric: Organizational Unit 선택"),a("br"),t._v(" "),a("img",{attrs:{src:s(357),alt:""}})])]),t._v(" "),a("p",[t._v("users 또는 groups입력"),a("br"),t._v(" "),a("img",{attrs:{src:s(358),alt:""}})]),t._v(" "),a("p",[t._v("[Commit]클릭"),a("br"),t._v(" "),a("img",{attrs:{src:s(359),alt:""}})]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("user추가")]),a("br"),t._v("\nou=users선택 > Create a child entry 클릭"),a("br"),t._v(" "),a("img",{attrs:{src:s(360),alt:""}}),t._v("\n'Default'선택"),a("br"),t._v(" "),a("img",{attrs:{src:s(361),alt:""}}),t._v("\n'iNetOrgPerson'선택"),a("br"),t._v(" "),a("img",{attrs:{src:s(362),alt:""}}),t._v("\nRDN은 'Usern Name(uid)'선택. cn, sn, password, username입력"),a("br"),t._v(" "),a("img",{attrs:{src:s(363),alt:""}}),t._v("\n[Commit]클릭"),a("br"),t._v(" "),a("img",{attrs:{src:s(364),alt:""}})])]),t._v(" "),a("p",[t._v("다른 사용자 추가시에는 기존 user를 복사하여 생성하는게 편함"),a("br"),t._v(" "),a("img",{attrs:{src:s(365),alt:""}}),t._v(" "),a("img",{attrs:{src:s(366),alt:""}}),t._v(" "),a("img",{attrs:{src:s(367),alt:""}})]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("group추가")]),a("br"),t._v("\nou=groups선택 > Create a child entry 클릭"),a("br"),t._v(" "),a("img",{attrs:{src:s(368),alt:""}}),t._v("\n'Default'선택"),a("br"),t._v(" "),a("img",{attrs:{src:s(369),alt:""}}),t._v("\n'groupOfUniqueNames'선택"),a("br"),t._v(" "),a("img",{attrs:{src:s(370),alt:""}}),t._v("\nRDN은 'cn(cn)'선택. cn, uniqueMember선택"),a("br"),t._v(" "),a("img",{attrs:{src:s(371),alt:""}}),t._v("\n[Commit]클릭"),a("br"),t._v(" "),a("img",{attrs:{src:s(372),alt:""}}),t._v("\n다른 그룹 추가시에는 user복사와 유사하게 'Copy or move this entry'를 클릭하여 기존 group을 복사하여 생성하면 됨"),a("br"),t._v(" "),a("img",{attrs:{src:s(373),alt:""}})])])])]),t._v(" "),a("h3",{attrs:{id:"snapshot-작성"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#snapshot-작성"}},[t._v("#")]),t._v(" snapshot 작성")]),t._v(" "),a("p",[t._v("Common Service 설치 전에 모든 VM들의 snapshot을 작성합니다.")]),t._v(" "),a("h2",{attrs:{id:"ibm-common-service-설치"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ibm-common-service-설치"}},[t._v("#")]),t._v(" IBM Common Service 설치")]),t._v(" "),a("h3",{attrs:{id:"설치registry를-접근하기-위한-entitlement-key취득"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#설치registry를-접근하기-위한-entitlement-key취득"}},[t._v("#")]),t._v(" 설치registry를 접근하기 위한 entitlement key취득")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("Installing > Installing with the cloud pak CLI클릭")]),a("br"),t._v(" "),a("img",{attrs:{src:s(374),alt:""}})]),t._v(" "),a("li",[a("strong",[t._v("MyIBM Container Software library클릭")]),a("br"),t._v(" "),a("a",{attrs:{href:"https://myibm.ibm.com/products-services/containerlibrary",target:"_blank",rel:"noopener noreferrer"}},[t._v("MyIBM Container Software library"),a("OutboundLink")],1),t._v(" "),a("img",{attrs:{src:s(375),alt:""}})]),t._v(" "),a("li",[a("strong",[t._v("Login")]),a("br"),t._v(" "),a("img",{attrs:{src:s(376),alt:""}})]),t._v(" "),a("li",[a("strong",[t._v("Key값 복사")]),a("br"),t._v(" "),a("img",{attrs:{src:s(377),alt:""}})])]),t._v(" "),a("h3",{attrs:{id:"설치-configuration-files-생성"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#설치-configuration-files-생성"}},[t._v("#")]),t._v(" 설치 configuration files 생성")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("환경변수값 셋팅")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("<apikey>에는 위에서 복사한 key값을 입력하면 됨  \n$ export ENTITLED_REGISTRY=cp.icr.io\n$ export ENTITLED_REGISTRY_USER=cp\n$ export ENTITLED_REGISTRY_KEY=<apikey>\n")])])]),a("ul",[a("li",[a("strong",[t._v("registry login")]),a("br"),t._v("\nbastion VM에 docker 설치를 먼저 하십시오."),a("br"),t._v(" "),a("a",{attrs:{href:"https://happycloud-lee.tistory.com/14?category=830565",target:"_blank",rel:"noopener noreferrer"}},[t._v("centos7에 docker설치"),a("OutboundLink")],1)])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('$ docker login "$ENTITLED_REGISTRY" -u "$ENTITLED_REGISTRY_USER" -p "$ENTITLED_REGISTRY_KEY"\n')])])]),a("ul",[a("li",[a("strong",[t._v("container image을 pulling하고 라이센스 보기")]),a("br"),t._v("\n'icpa-installer:4.1.1'는 설치 버전에 맞게 변경하십시오.")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('$ docker run -e LICENSE=view \\\n           "$ENTITLED_REGISTRY/cp/icpa/icpa-installer:4.1.1"\n')])])]),a("p",[a("img",{attrs:{src:s(378),alt:""}}),t._v(" "),a("img",{attrs:{src:s(379),alt:""}})]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("설치 config파일들 생성")]),a("br"),t._v("\n'icpa-installer:4.1.1'는 설치 버전에 맞게 변경하십시오.")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('$ mkdir ~/data\n$ docker run -v $PWD/data:/data:z -u 0 \\\n           -e LICENSE=accept \\\n           "$ENTITLED_REGISTRY/cp/icpa/icpa-installer:4.1.1" cp -r "data/*" /data\n')])])]),a("p",[a("img",{attrs:{src:s(380),alt:""}})]),t._v(" "),a("h3",{attrs:{id:"설치-config파일들-수정"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#설치-config파일들-수정"}},[t._v("#")]),t._v(" 설치 config파일들 수정")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("Installing > Installing with the cloud pak CLI > Installing Common Services 클릭")]),a("br"),t._v(" "),a("img",{attrs:{src:s(327),alt:""}})])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("commonservice.yaml 수정")]),a("br"),t._v("\nstorageClass, dedicatedNodes, services를 수정합니다."),a("br"),t._v(" "),a("img",{attrs:{src:s(381),alt:""}})])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SAMPLE\n\n...\nspec:\n  ...\n  storageClass: thin\n  ...\n  dedicatedNodes:\n    - worker-1.hcis.kubepia.com \n    - worker-2.hcis.kubepia.com\n    - worker-3.hcis.kubepia.com\n  ...\n\n")])])]),a("ul",[a("li",[t._v("storageClass: 'thin'으로 지정"),a("br"),t._v("\nProvisioner가 'kubernetes.io/no-provisioner'가 아니고 accessMode가 ReadWriteOnce인 Storage Class지정")]),t._v(" "),a("li",[t._v("dedicatedNodes: common service가 설치될 Worker Node들 지정."),a("br"),t._v("\nHA를 위해 1개 이상의 홀수로 지정하여야 함")]),t._v(" "),a("li",[t._v("services: 설치할 service는 present로 변경.")])]),t._v(" "),a("h3",{attrs:{id:"installer-실행"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#installer-실행"}},[t._v("#")]),t._v(" installer 실행")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("cluster login")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ oc login https://<your_cluster_hostname> -u <username> -p <password>\n")])])]),a("p",[a("img",{attrs:{src:s(382),alt:""}})]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("oc login이 아래 에러가 나면 ~/.kube/config파일을 삭제하고, 다시 로그인하시면 됩니다."),a("br"),t._v("\nerror: x509: certificate signed by unknown authority")])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("installer 실행")]),a("br"),t._v("\n'icpa-installer:4.1.1'는 설치 버전에 맞게 변경하십시오.\n반드시 install yaml파일들이 있는 data디렉토리의 상위 디렉토리에서 수행하세요.")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('$ docker run -v ~/.kube:/root/.kube:z -u 0 -t \\\n          -v $PWD/data:/installer/data:z \\\n          -e LICENSE=accept \\\n          -e ENTITLED_REGISTRY -e ENTITLED_REGISTRY_USER -e ENTITLED_REGISTRY_KEY \\\n          "$ENTITLED_REGISTRY/cp/icpa/icpa-installer:4.1.1" cs-install\n')])])]),a("p",[t._v("설치 진행상황은 Terminal console보다는 OCP Webconsole의 Event를 보시는게 더 좋습니다."),a("br"),t._v("\n계속 동일한 에러가 발생하면(예: PV binding 에러, pull image fail등) 중단하고 원인을 조치한 후"),a("br"),t._v("\n재시도 하십시오.\n"),a("img",{attrs:{src:s(383),alt:""}})]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("설치 실패시 clear")]),t._v(" "),a("p",[t._v("설치 실패 시 처음부터 다시 설치하려면 uninstall을 먼저해야 합니다."),a("br"),t._v("\n위 명령어의 가장 마지막 'cs-install'을 'cs-uninstall'로 바꿔서 실행하면 됩니다."),a("br"),t._v("\n재시도 시 시작하자 마자 2단계정도에서 실패하면 위 docker login과 oc login을"),a("br"),t._v("\n다시 한번 하고 설치하십시오.")]),t._v(" "),a("p",[t._v("그 외 에러는 "),a("a",{attrs:{href:"https://www.ibm.com/support/knowledgecenter/SSCSJL_4.1.x/troubleshoot-cs.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Common service install Trouble shooting guide"),a("OutboundLink")],1),t._v("를 참조하세요.")])]),t._v(" "),a("h3",{attrs:{id:"common-service-로그인"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#common-service-로그인"}},[t._v("#")]),t._v(" Common Service 로그인")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("install 완료 확인")]),a("br"),t._v("\n완료 메시지에서 common service url, default admin id, default admin password를 구합니다."),a("br"),t._v(" "),a("img",{attrs:{src:s(384),alt:""}})])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("default admin id : csadmin\n$ oc -n ibmplatform-service get secret admin-credential -o jsonpath='{.data.defaultAdminUser}' | base64 --decode\n\ndefault admin pw\n$ oc -n ibmplatform-service get secret admin-credential -o jsonpath='{.data.defaultAdminPassword}' | base64 --decode\n")])])]),a("ul",[a("li",[a("strong",[t._v("Common Service 로그인")]),a("br"),t._v("\n위에서 구한 url로 접근하고, admin id/pw로 로그인합니다."),a("br"),t._v(" "),a("img",{attrs:{src:s(385),alt:""}}),t._v(" "),a("img",{attrs:{src:s(386),alt:""}})])]),t._v(" "),a("h2",{attrs:{id:"ibm-common-service-설정"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ibm-common-service-설정"}},[t._v("#")]),t._v(" IBM Common Service 설정")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("LDAP Connection 추가")])])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("항목")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("설명")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("예")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("connection name")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("적절하게 구별된 이름 부여")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("seromi-ldap")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Server type")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("LDAP 종류. openldap은 Custom선택")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Custom")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Base DN")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("LDAP Hostname에 따라 구별된 이름 지정")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("dc=ldap,dc=cp,dc=darumtech,dc=net")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Bind DN")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("LDAP admin의 구별된 이름 지정")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("cn=admin,dc=ldap,dc=cp,dc=darumtech,dc=net")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Bind DN paessword")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("LDAP admin 암호")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("생략")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("LDAP server")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ldap://[서비스명(oc get svc -n ldap으로 구함)].[namespace].svc:389")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ldap://ldap-openldap.ldap.svc:389")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Group filter")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Group가져올때 query")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("(&(cn=%v)(objectclass=groupOfUniqueNames))")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("User filter")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("User가져올때 query")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("(&(uid=%v)(objectclass=inetOrgPerson))")])])])]),t._v(" "),a("p",[a("img",{attrs:{src:s(387),alt:""}}),t._v(" "),a("img",{attrs:{src:s(388),alt:""}}),t._v(" "),a("img",{attrs:{src:s(389),alt:""}})]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("Team 추가")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("Teams탭을 클릭하고 [Create Team]클릭"),a("br"),t._v(" "),a("img",{attrs:{src:s(390),alt:""}})])]),t._v(" "),a("li",[a("p",[t._v("Member로 LDAP user/group지정"),a("br"),t._v(" "),a("img",{attrs:{src:s(391),alt:""}}),t._v(" "),a("img",{attrs:{src:s(392),alt:""}})])])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Namespace 권한 부여")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("권한을 부여할 Team을 클릭합니다."),a("br"),t._v(" "),a("img",{attrs:{src:s(393),alt:""}})])]),t._v(" "),a("li",[a("p",[t._v("Resources탭을 클릭하고 [Manage resource]를 클릭합니다."),a("br"),t._v(" "),a("img",{attrs:{src:s(394),alt:""}})])]),t._v(" "),a("li",[a("p",[t._v("권한부여할 namespace들을 체크합니다."),a("br"),t._v(" "),a("img",{attrs:{src:s(395),alt:""}})])])])])]),t._v(" "),a("h2",{attrs:{id:"ocp-ocp-idp로-등록"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ocp-ocp-idp로-등록"}},[t._v("#")]),t._v(" OCP-OCP IdP로 등록")]),t._v(" "),a("p",[t._v("OCP의 IdP로 Common Service를 등록합니다.")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("IdP등록 가이드 오픈")]),a("br"),t._v("\n설치 가이드에서 '\nSetting up IBM Common IAM as OpenShift OAuth Identity Provider'을 클릭합니다."),a("br"),t._v(" "),a("img",{attrs:{src:s(396),alt:""}})])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Common IAM의 admin id/pw를 구합니다.")])])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ oc -n ibmplatform-service get secret admin-credential -o jsonpath='{.data.defaultAdminUser}' | base64 --decode\n\n$ oc -n ibmplatform-service get secret admin-credential -o jsonpath='{.data.defaultAdminPassword}' | base64 --decode\n")])])]),a("ul",[a("li",[a("strong",[t._v("Common Service dashboard URL을 구합니다.")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ oc -n kube-system get route icp-console -o=jsonpath={.spec.host}\n")])])]),a("ul",[a("li",[a("strong",[t._v("Common Service CA(Certificate Authority) File생성")]),a("br"),t._v("\n아래 명령으로 icp-console.pem파일을 생성합니다.")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ oc -n kube-system get secret icp-management-ingress-tls-secret -o=jsonpath='{.data.tls\\.crt}' | base64 --decode | tee -a icp-console.pem\n")])])]),a("ul",[a("li",[a("strong",[t._v("Client 리소스 생성")]),a("br"),t._v(" "),a("strong",[t._v("openclient.yaml생성")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ vi openclient.yaml \n\napiVersion: oidc.security.ibm.com/v1\nkind: Client\nmetadata:\n  namespace: default\n  name: ocpclient\nspec:\n  secret: ocpclientsecret\n  oidcLibertyClient:\n    post_logout_redirect_uris:\n    - https://console-openshift-console.apps.example.com:443\n    trusted_uri_prefixes:\n    - https://console-openshift-console.apps.example.com:443\n    redirect_uris:\n    - https://oauth-openshift.apps.example.com/oauth2callback/IBM-IAM\n")])])]),a("p",[a("strong",[t._v("'oidcLibertyClient' 하위의 주소 3개를 변경합니다.")]),a("br"),t._v(" "),a("img",{attrs:{src:s(397),alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("Client 리소스 생성")]),a("br"),t._v("\n$ oc apply -f openclient.yaml")]),t._v(" "),a("p",[a("strong",[t._v("리소스 생성 확인")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ oc get Client ocpclient -n default\n")])])]),a("ul",[a("li",[a("strong",[t._v("CLIENT_ID와 CLIENT_SECRET값을 구합니다.")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ oc -n default get secret ocpclientsecret -o jsonpath='{.data.CLIENT_ID}' | base64 --decode\n$ oc -n default get secret ocpclientsecret -o jsonpath='{.data.CLIENT_SECRET}' | base64 --decode\n")])])]),a("ul",[a("li",[a("strong",[t._v("OCP OAuth페이지 오픈")]),a("br"),t._v("\ncluster-admin역할을 가진 사용자(예:kubeadmin)로 로그인합니다."),a("br"),t._v("\nAdministration > Cluster Settings을 선택 후 Global Configuration탭을 누릅니다."),a("br"),t._v(" "),a("img",{attrs:{src:s(398),alt:""}})])]),t._v(" "),a("p",[t._v("OAuth를 찾아 클릭합니다."),a("br"),t._v(" "),a("img",{attrs:{src:s(399),alt:""}})]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("IdP추가")])]),t._v(" "),a("ul",[a("li",[t._v("Identity Providers에서 [Add]클릭하고, OpenID Connect를 선택합니다."),a("br"),t._v(" "),a("img",{attrs:{src:s(400),alt:""}})]),t._v(" "),a("li",[t._v("Name, Client ID, Client Secret, Issuer URL을 입력합니다."),a("br"),t._v(" "),a("strong",[t._v("Name은 반드시 'IBM-IAM'으로 해야 합니다.")]),a("br"),t._v(" "),a("strong",[t._v("Issuer URL은 [Common Services dashboard URL]/oidc/endpoint/OP입니다.")]),a("br"),t._v(" "),a("img",{attrs:{src:s(401),alt:""}})]),t._v(" "),a("li",[t._v("CA File, Extra Scopes를 입력합니다."),a("br"),t._v(" "),a("strong",[t._v("Extra Scopes의 값은 반드시 'profile'로 해야 합니다.")]),a("br"),t._v(" "),a("img",{attrs:{src:s(402),alt:""}})])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Common Service로 로그인")]),a("br"),t._v("\nLogout을 하면 로그인페이지에 IBM-IAM이라는 버튼이 표시됩니다."),a("br"),t._v(" "),a("img",{attrs:{src:s(403),alt:""}})])])]),t._v(" "),a("p",[t._v("IBM-IAM을 클릭하면 Common Service Login페이지가 표시됩니다."),a("br"),t._v(" "),a("img",{attrs:{src:s(404),alt:""}})]),t._v(" "),a("p",[t._v("로그인이 정상적으로 되면 OCP 초기화면이 표시됩니다."),a("br"),t._v(" "),a("img",{attrs:{src:s(405),alt:""}})]),t._v(" "),a("h2",{attrs:{id:"logout-버그-fix"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#logout-버그-fix"}},[t._v("#")]),t._v(" Logout 버그 Fix")]),t._v(" "),a("p",[t._v("IBM Common Service로 로그인을 하면 Logout이 안되는 버그가 있습니다."),a("br"),t._v(" "),a("a",{attrs:{href:"https://happycloud-lee.tistory.com/118",target:"_blank",rel:"noopener noreferrer"}},[t._v("IBM CommonService IAM 로그아웃 안되는 현상 해결"),a("OutboundLink")],1),t._v("문서를 참조하여 처리하십시오.")]),t._v(" "),a("hr"),t._v(" "),a("p",[a("strong",[t._v("중요: User Identities 초기화")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("각 사용자는 인증 IdP에 따라 Identities값이 셋팅됩니다."),a("br"),t._v("\nIdP가 변경된다면(예: htpasswd => Common Service IAM) Identities값을 초기화해줘야 합니다."),a("br"),t._v("\n예를 들어 user1이 htpasswd로 등록되었다가 Common Service의 LDAP에 등록된 경우"),a("br"),t._v("\n만약 user1이 htpasswd로 로그인했다면 Identities는 'htpasswd-user1'이 됩니다."),a("br"),t._v("\nuser1을 LDAP에 등록 후 Common Service로 로그인하려고 하면"),a("br"),t._v("\n'사용자를 생성할 수 없다'라는 에러가 납니다.")]),t._v(" "),a("p",[a("strong",[t._v("Identities값 초기화는 YAML을 편집하여 identities의 값을 'null'로 변경하면 됩니다.")])]),t._v(" "),a("p",[a("img",{attrs:{src:s(406),alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:s(407),alt:""}})])]),t._v(" "),a("hr"),t._v(" "),a("disqus")],1)}),[],!1,null,null,null);e.default=r.exports}}]);