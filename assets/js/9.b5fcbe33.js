(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{553:function(s,t,a){s.exports=a.p+"assets/img/2020-05-31-14-22-26.0c5f5ee6.png"},554:function(s,t,a){s.exports=a.p+"assets/img/2020-05-31-14-22-41.da27fbcd.png"},555:function(s,t,a){s.exports=a.p+"assets/img/2020-05-31-14-24-59.63cd280d.png"},556:function(s,t,a){s.exports=a.p+"assets/img/2020-05-31-14-29-38.4ab02910.png"},557:function(s,t,a){s.exports=a.p+"assets/img/2020-05-31-14-33-29.8231fa73.png"},558:function(s,t,a){s.exports=a.p+"assets/img/2020-05-31-14-36-32.ef13b717.png"},559:function(s,t,a){s.exports=a.p+"assets/img/2020-05-31-14-52-25.2027d6ba.png"},560:function(s,t,a){s.exports=a.p+"assets/img/2020-05-31-14-39-16.0121b6b0.png"},561:function(s,t,a){s.exports=a.p+"assets/img/2020-05-31-15-47-13.c3671809.png"},562:function(s,t,a){s.exports=a.p+"assets/img/2020-05-31-15-47-59.9f751959.png"},610:function(s,t,a){"use strict";a.r(t);var e=a(25),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"ocp-idp-추가"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ocp-idp-추가"}},[s._v("#")]),s._v(" OCP-IdP 추가")]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("TASK DESCRIPTION")]),s._v(" "),e("p",[s._v("계정제공자(IdP-Identity Provider)를 추가합니다"),e("br"),s._v("\n본 매뉴얼에서는 htpasswd와 keycloak을 설명합니다.")]),s._v(" "),e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#htpasswd-추가"}},[s._v("htpasswd 추가")])]),e("li",[e("a",{attrs:{href:"#keycloak-추가"}},[s._v("keycloak 추가")]),e("ul",[e("li",[e("a",{attrs:{href:"#keycloak-설치"}},[s._v("keycloak 설치")])]),e("li",[e("a",{attrs:{href:"#key-cloak-설정-realm-client-작성"}},[s._v("key cloak 설정: realm, client 작성")])]),e("li",[e("a",{attrs:{href:"#ocp의-idp로-keycloak-등록"}},[s._v("OCP의 IdP로 keycloak 등록")])])])])])]),e("p")]),s._v(" "),e("h2",{attrs:{id:"htpasswd-추가"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#htpasswd-추가"}},[s._v("#")]),s._v(" htpasswd 추가")]),s._v(" "),e("p",[s._v("htpasswd는 OCP자체적으로 계정을 추가할 수 있는 방법입니다.")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("계정 등록 파일 생성")])])]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ yum install -y httpd-tools  \n$ which htpasswd  \n$ htpasswd -c -B -b <파일명> <user_name> <password>  \n계정 추가시에는 -c옵션 주면 안됨   \n예) \n[root@bastion idp]# htpasswd -c -B -b users.htpasswd hklee passw0rd \\\nAdding password for user hklee \\\n[root@bastion idp]# htpasswd -B -b users.htpasswd sihan passw0rd \\\nAdding password for user sihan \\\n[root@bastion idp]# htpasswd -B -b users.htpasswd shlee passw0rd \\\nAdding password for user shlee \\\n[root@bastion idp]# cat users.htpasswd \\\nhklee:$2y$05$1ZSl07frbmRvwY2Uxuz.Cu38bTh.UMR8wAD1/i5YTOuym0yhX8F4S \\\nsihan:$2y$05$VF9BcY4pSPTy7uParHwZt.Qaf5agVto5EduZXmuPGwFxOyqdNRPqu \\\nshlee:$2y$05$Lx9qrVCFnC1weCMkOkj/jOA6kOkM49CjhnQrOOVFHmyrwhHz0b2Ta \\\n")])])]),e("ul",[e("li",[e("p",[e("strong",[s._v("IdP추가")])]),s._v(" "),e("ul",[e("li",[s._v("OCP webconsole로그인: 최초에는 kubeadmin으로 로그인")]),s._v(" "),e("li",[s._v("Administration->Cluster-Settings클릭")]),s._v(" "),e("li",[s._v("Global configuration탭 클릭하고 oAuth 클릭")]),s._v(" "),e("li",[s._v("IdP추가: htpasswd 선택하고 위에서 생성한 파일 지정")])])]),s._v(" "),e("li",[e("p",[e("strong",[s._v("rolebinding")]),e("br"),s._v("\n추가한 user에게 권한을 binding 합니다.")]),s._v(" "),e("ul",[e("li",[s._v("OCP web console > user management > Role bindings")]),s._v(" "),e("li",[s._v("create role binding")])])])]),s._v(" "),e("h2",{attrs:{id:"keycloak-추가"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#keycloak-추가"}},[s._v("#")]),s._v(" keycloak 추가")]),s._v(" "),e("h3",{attrs:{id:"keycloak-설치"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#keycloak-설치"}},[s._v("#")]),s._v(" keycloak 설치")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("작업디렉토리 생성")]),e("br"),s._v("\ncluster접근할 수 있는 Terminal에서 작업(예: bastion VM에서 작업)")])]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p ~/tmp/keycloak\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/tmp/keycloak \n")])])]),e("ul",[e("li",[e("strong",[s._v("namespace 생성")])])]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("$ oc new-project keycloak\n$ oc adm policy add-scc-to-user anyuid -z default \n$ oc project keycloak\n")])])]),e("ul",[e("li",[e("strong",[s._v("helm repository 추가")])])]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("$ helm repo "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" codecentric https://codecentric.github.io/helm-charts\n$ helm search repo keycloak\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@bastion ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm search repo keycloak")]),s._v("\nNAME                \tCHART VERSION\tAPP VERSION\tDESCRIPTION\ncodecentric/keycloak\t"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.2")]),s._v(".2        \t"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0     \tOpen Source Identity and Access Management For "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nstable/keycloak     \t"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.10")]),s._v(".1       \t"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),s._v(".0      \tDEPRECATED - Open Source Identity and Access Ma\n")])])]),e("ul",[e("li",[e("strong",[s._v("helm으로 keycloak설치")])])]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("$ helm inspect values codecentric/keycloak "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" config.yaml\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" config.yaml\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Username for the initial Keycloak admin user")]),s._v("\n  username: keycloak\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Password for the initial Keycloak admin user. Applicable only if existingSecret is not set.")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## If not set, a random 10 characters password will be used")]),s._v("\n  password: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"passw0rd"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## OpenShift route configuration.")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ref: https://docs.openshift.com/container-platform/3.11/architecture/networking/routes.html")]),s._v("\n  route:\n    enabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    path: /\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Persistence configuration")]),s._v("\n  persistence:\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If true, the Postgres chart is deployed")]),s._v("\n    deployPostgres: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# The database vendor. Can be either "postgres", "mysql", "mariadb", or "h2"')]),s._v("\n    dbVendor: postgres\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\npostgresql:\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### PostgreSQL User to create.")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##")]),s._v("\n  postgresqlUsername: keycloak\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## PostgreSQL Password for the new user.")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## If not set, a random 10 characters password will be used.")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##")]),s._v("\n  postgresqlPassword: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"passw0rd"')]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Persistent Volume Storage configuration.")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ref: https://kubernetes.io/docs/user-guide/persistent-volumes")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##")]),s._v("\n  persistence:\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Enable PostgreSQL persistence using Persistent Volume Claims.")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##")]),s._v("\n    enabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\n$ helm "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" keycloak -f config.yaml codecentric/keycloak -n keycloak\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" oc get po\nEvery "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".0s: oc get po                                                                                                                                Sun May "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":17:18 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("\n\nNAME                    READY   STATUS              RESTARTS   AGE\nkeycloak-0              "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Init:0/1            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          12s\nkeycloak-postgresql-0   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     ContainerCreating   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          12s\n\n")])])]),e("ul",[e("li",[e("strong",[s._v("keycloak 로그인")])])]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("$ oc get route \n\n")])])]),e("p",[s._v("웹브라우저에서 위 주소로 접근합니다."),e("br"),s._v("\nconfig.yaml에서 지정한 id와 pw로 로그인합니다.")]),s._v(" "),e("p",[e("img",{attrs:{src:a(553),alt:""}})]),s._v(" "),e("p",[e("img",{attrs:{src:a(554),alt:""}})]),s._v(" "),e("h3",{attrs:{id:"key-cloak-설정-realm-client-작성"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#key-cloak-설정-realm-client-작성"}},[s._v("#")]),s._v(" "),e("strong",[s._v("key cloak 설정: realm, client 작성")])]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("realm 작성")]),e("br"),s._v("\nrealm은 인증대상범위를 의미합니다.")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(555),alt:""}}),s._v(" "),e("img",{attrs:{src:a(556),alt:""}})]),s._v(" "),e("p",[s._v("issuer주소를 clipboard에 복사해 놓습니다."),e("br"),s._v(" "),e("img",{attrs:{src:a(557),alt:""}}),s._v(" "),e("img",{attrs:{src:a(558),alt:""}})]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("예) https://keycloak-keycloak.apps.cp.kubepia.com/auth/realms/kubepia\n")])])]),e("p",[s._v("public key값을 Local PC에 파일로 생성합니다.\n"),e("img",{attrs:{src:a(559),alt:""}})]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("public key Sample\n\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnXVty1Q9jiObqJYPPAGLMiPhm8a+nVncMWoL9KVO4pZPkA6PQsYcMzq+YQyHQy442p+l8d2si5ZcNgLnnfH7WtiysMxRVUHKeNtGAetSwZIb2r/WLapiEoBoXSBZ4hREWaYfZqJAzrxgpRGsl8J5MmYj0HLoXQdY6H3CuPN+770EAA411Xvr31Z9MloC4/XKO+ZxqXUk5N8cCSWvPt1hyWpG32/fqgglcKUCdbJ1P4ieYT9y8NkBzHG9+CfGJUr7Sh7goSTKiO0gAoP/b32lmTGWnmV91JcYOmGQXbkBBA8kfB0l6C+TG574sIwmChemhNeMjU6SKCvM56RqvNR7rQIDAQAB\n")])])]),e("ul",[e("li",[e("strong",[s._v("Client 작성")])])]),s._v(" "),e("p",[s._v("Client는 keycloak으로 인증을 요청하는 소스 어플리케이션입니다.")]),s._v(" "),e("p",[e("img",{attrs:{src:a(560),alt:""}}),s._v(" "),e("img",{attrs:{src:a(561),alt:""}})]),s._v(" "),e("p",[s._v("Credential값을 clipboard에 복사합니다."),e("br"),s._v(" "),e("img",{attrs:{src:a(562),alt:""}})]),s._v(" "),e("h3",{attrs:{id:"ocp의-idp로-keycloak-등록"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ocp의-idp로-keycloak-등록"}},[s._v("#")]),s._v(" OCP의 IdP로 keycloak 등록")]),s._v(" "),e("p",[s._v("등록방법 찾는중입니다.")]),s._v(" "),e("hr"),s._v(" "),e("disqus")],1)}),[],!1,null,null,null);t.default=n.exports}}]);